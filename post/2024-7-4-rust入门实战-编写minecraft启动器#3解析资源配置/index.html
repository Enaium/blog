<!doctype html><html><head><meta charset=UTF-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><title>Rust入门实战 编写Minecraft启动器#3解析资源配置</title>
<link rel=stylesheet href=/css/bootstrap.min.css><link rel=stylesheet href=/css/styles.css></head><body class="d-flex flex-column justify-content-between min-vh-100"><nav class="navbar navbar-expand-lg bg-light"><div class=container-fluid><a class=navbar-brand href=/><img src=/assets/github.svg alt=Logo width=30 height=24 class="d-inline-block align-text-top">
Enaium的博客
</a><button class=navbar-toggler type=button data-bs-toggle=collapse data-bs-target=#navbarNav aria-controls=navbarNav aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse" id=navbarNav><ul class=navbar-nav><li class=nav-item><a class=nav-link aria-current=page href=https://blog.enaium.cn/contact/>联系</a></li><li class=nav-item><a class=nav-link aria-current=page href=https://blog.enaium.cn/about/>关于</a></li><li class="nav-item dropdown"><a class="nav-link dropdown-toggle" data-bs-toggle=dropdown href=# role=button aria-expanded=false><img alt=Logo width=30 height=24 src=/assets/language.svg></a><ul class=dropdown-menu></ul></li></ul></div></div></nav><div style=flex:1><div class=container><div class=card><div class=card-header>Rust入门实战 编写Minecraft启动器#3解析资源配置</div><div class=card-body><div class=card-text><p>在上一篇文章中，我们已经建立了资源模型，接下来我们需要解析游戏的配置文件。</p><p>首先我们添加<code>serde_json</code>依赖和<code>model</code>依赖。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-toml data-lang=toml><span style=display:flex><span><span style=color:#a6e22e>model</span> = { <span style=color:#a6e22e>path</span> = <span style=color:#e6db74>&#34;../model&#34;</span> }
</span></span><span style=display:flex><span><span style=color:#a6e22e>serde_json</span> = <span style=color:#e6db74>&#34;1.0&#34;</span>
</span></span></code></pre></div><p>之后我们在<code>lib.rs</code>中添加解析的<code>trait</code>。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=display:flex><span><span style=color:#66d9ef>pub</span> <span style=color:#66d9ef>trait</span> Parse<span style=color:#f92672>&lt;</span>T<span style=color:#f92672>&gt;</span>: Sized {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>type</span> <span style=color:#a6e22e>Error</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fn</span> <span style=color:#a6e22e>parse</span>(value: <span style=color:#a6e22e>T</span>) -&gt; Result<span style=color:#f92672>&lt;</span>Self, Self::Error<span style=color:#f92672>&gt;</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>之后将所有的<code>model</code>都实现这个<code>trait</code>，并测试它们。这里其实只用将需要手动解析的实现这个<code>trait</code>，其他的会在我们用<code>reqwest</code>下载的时候自动解析。</p><p><code>asset.rs</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=display:flex><span><span style=color:#66d9ef>use</span> model::asset::<span style=color:#f92672>*</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>use</span> <span style=color:#66d9ef>crate</span>::Parse;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>impl</span> Parse<span style=color:#f92672>&lt;&amp;</span><span style=color:#66d9ef>str</span><span style=color:#f92672>&gt;</span> <span style=color:#66d9ef>for</span> AssetIndex {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>type</span> <span style=color:#a6e22e>Error</span> <span style=color:#f92672>=</span> serde_json::Error;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fn</span> <span style=color:#a6e22e>parse</span>(value: <span style=color:#66d9ef>&amp;</span><span style=color:#66d9ef>str</span>) -&gt; Result<span style=color:#f92672>&lt;</span>Self, Self::Error<span style=color:#f92672>&gt;</span> {
</span></span><span style=display:flex><span>        serde_json::from_str::<span style=color:#f92672>&lt;</span>AssetIndex<span style=color:#f92672>&gt;</span>(value)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>impl</span> Parse<span style=color:#f92672>&lt;&amp;</span><span style=color:#66d9ef>str</span><span style=color:#f92672>&gt;</span> <span style=color:#66d9ef>for</span> Index {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>type</span> <span style=color:#a6e22e>Error</span> <span style=color:#f92672>=</span> serde_json::Error;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fn</span> <span style=color:#a6e22e>parse</span>(value: <span style=color:#66d9ef>&amp;</span><span style=color:#66d9ef>str</span>) -&gt; Result<span style=color:#f92672>&lt;</span>Self, Self::Error<span style=color:#f92672>&gt;</span> {
</span></span><span style=display:flex><span>        serde_json::from_str::<span style=color:#f92672>&lt;</span>Index<span style=color:#f92672>&gt;</span>(value)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>impl</span> Parse<span style=color:#f92672>&lt;&amp;</span><span style=color:#66d9ef>str</span><span style=color:#f92672>&gt;</span> <span style=color:#66d9ef>for</span> Object {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>type</span> <span style=color:#a6e22e>Error</span> <span style=color:#f92672>=</span> serde_json::Error;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fn</span> <span style=color:#a6e22e>parse</span>(value: <span style=color:#66d9ef>&amp;</span><span style=color:#66d9ef>str</span>) -&gt; Result<span style=color:#f92672>&lt;</span>Self, Self::Error<span style=color:#f92672>&gt;</span> {
</span></span><span style=display:flex><span>        serde_json::from_str::<span style=color:#f92672>&lt;</span>Object<span style=color:#f92672>&gt;</span>(value)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#[cfg(test)]</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>mod</span> tests {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>use</span> <span style=color:#66d9ef>super</span>::<span style=color:#f92672>*</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>#[test]</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fn</span> <span style=color:#a6e22e>test_asset_index</span>() {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>let</span> asset_index <span style=color:#f92672>=</span> AssetIndex::parse(
</span></span><span style=display:flex><span>        <span style=color:#e6db74>r</span><span style=color:#e6db74>#&#34;{&#34;id&#34;: &#34;17&#34;, &#34;sha1&#34;: &#34;fab15439bdef669e389e25e815eee8f1b2aa915e&#34;, &#34;size&#34;: 447033, &#34;totalSize&#34;: 799252591, &#34;url&#34;: &#34;https://piston-meta.mojang.com/v1/packages/fab15439bdef669e389e25e815eee8f1b2aa915e/17.json&#34;}&#34;#</span>).unwrap_or_else(<span style=color:#f92672>|</span>err<span style=color:#f92672>|</span> panic!(<span style=color:#e6db74>&#34;</span><span style=color:#e6db74>{:?}</span><span style=color:#e6db74>&#34;</span>,err));
</span></span><span style=display:flex><span>        assert_eq!(<span style=color:#e6db74>&#34;17&#34;</span>, asset_index.id);
</span></span><span style=display:flex><span>        assert_eq!(<span style=color:#e6db74>&#34;fab15439bdef669e389e25e815eee8f1b2aa915e&#34;</span>, asset_index.sha1);
</span></span><span style=display:flex><span>        assert_eq!(<span style=color:#ae81ff>447033</span>, asset_index.size);
</span></span><span style=display:flex><span>        assert_eq!(<span style=color:#ae81ff>799252591</span>, asset_index.total_size);
</span></span><span style=display:flex><span>        assert_eq!(<span style=color:#e6db74>&#34;https://piston-meta.mojang.com/v1/packages/fab15439bdef669e389e25e815eee8f1b2aa915e/17.json&#34;</span>, asset_index.url);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>#[test]</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fn</span> <span style=color:#a6e22e>test_index</span>() {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>let</span> index <span style=color:#f92672>=</span> Index::parse(<span style=color:#e6db74>r</span><span style=color:#e6db74>#&#34;{&#34;objects&#34;: {&#34;icons/icon_128x128.png&#34;: {&#34;hash&#34;: &#34;b62ca8ec10d07e6bf5ac8dae0c8c1d2e6a1e3356&#34;, &#34;size&#34;: 9101}}}&#34;#</span>)
</span></span><span style=display:flex><span>            .unwrap_or_else(<span style=color:#f92672>|</span>err<span style=color:#f92672>|</span> panic!(<span style=color:#e6db74>&#34;</span><span style=color:#e6db74>{:?}</span><span style=color:#e6db74>&#34;</span>,err));
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        assert_eq!(<span style=color:#ae81ff>1</span>, index.objects.len());
</span></span><span style=display:flex><span>        assert_eq!(
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#34;b62ca8ec10d07e6bf5ac8dae0c8c1d2e6a1e3356&#34;</span>,
</span></span><span style=display:flex><span>            index.objects.get(<span style=color:#e6db74>&#34;icons/icon_128x128.png&#34;</span>).unwrap().hash
</span></span><span style=display:flex><span>        );
</span></span><span style=display:flex><span>        assert_eq!(
</span></span><span style=display:flex><span>            <span style=color:#ae81ff>9101</span>,
</span></span><span style=display:flex><span>            index.objects.get(<span style=color:#e6db74>&#34;icons/icon_128x128.png&#34;</span>).unwrap().size
</span></span><span style=display:flex><span>        );
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p><code>library.rs</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=display:flex><span><span style=color:#66d9ef>use</span> model::library::<span style=color:#f92672>*</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>use</span> <span style=color:#66d9ef>crate</span>::Parse;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>impl</span> Parse<span style=color:#f92672>&lt;&amp;</span><span style=color:#66d9ef>str</span><span style=color:#f92672>&gt;</span> <span style=color:#66d9ef>for</span> Library {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>type</span> <span style=color:#a6e22e>Error</span> <span style=color:#f92672>=</span> serde_json::Error;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fn</span> <span style=color:#a6e22e>parse</span>(value: <span style=color:#66d9ef>&amp;</span><span style=color:#66d9ef>str</span>) -&gt; Result<span style=color:#f92672>&lt;</span>Self, Self::Error<span style=color:#f92672>&gt;</span> {
</span></span><span style=display:flex><span>        serde_json::from_str::<span style=color:#f92672>&lt;</span>Library<span style=color:#f92672>&gt;</span>(value)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>impl</span> Parse<span style=color:#f92672>&lt;&amp;</span><span style=color:#66d9ef>str</span><span style=color:#f92672>&gt;</span> <span style=color:#66d9ef>for</span> Rule {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>type</span> <span style=color:#a6e22e>Error</span> <span style=color:#f92672>=</span> serde_json::Error;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fn</span> <span style=color:#a6e22e>parse</span>(value: <span style=color:#66d9ef>&amp;</span><span style=color:#66d9ef>str</span>) -&gt; Result<span style=color:#f92672>&lt;</span>Self, Self::Error<span style=color:#f92672>&gt;</span> {
</span></span><span style=display:flex><span>        serde_json::from_str::<span style=color:#f92672>&lt;</span>Rule<span style=color:#f92672>&gt;</span>(value)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>impl</span> Parse<span style=color:#f92672>&lt;&amp;</span><span style=color:#66d9ef>str</span><span style=color:#f92672>&gt;</span> <span style=color:#66d9ef>for</span> Os {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>type</span> <span style=color:#a6e22e>Error</span> <span style=color:#f92672>=</span> serde_json::Error;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fn</span> <span style=color:#a6e22e>parse</span>(value: <span style=color:#66d9ef>&amp;</span><span style=color:#66d9ef>str</span>) -&gt; Result<span style=color:#f92672>&lt;</span>Self, Self::Error<span style=color:#f92672>&gt;</span> {
</span></span><span style=display:flex><span>        serde_json::from_str::<span style=color:#f92672>&lt;</span>Os<span style=color:#f92672>&gt;</span>(value)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>impl</span> Parse<span style=color:#f92672>&lt;&amp;</span><span style=color:#66d9ef>str</span><span style=color:#f92672>&gt;</span> <span style=color:#66d9ef>for</span> Download {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>type</span> <span style=color:#a6e22e>Error</span> <span style=color:#f92672>=</span> serde_json::Error;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fn</span> <span style=color:#a6e22e>parse</span>(value: <span style=color:#66d9ef>&amp;</span><span style=color:#66d9ef>str</span>) -&gt; Result<span style=color:#f92672>&lt;</span>Self, Self::Error<span style=color:#f92672>&gt;</span> {
</span></span><span style=display:flex><span>        serde_json::from_str::<span style=color:#f92672>&lt;</span>Download<span style=color:#f92672>&gt;</span>(value)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>impl</span> Parse<span style=color:#f92672>&lt;&amp;</span><span style=color:#66d9ef>str</span><span style=color:#f92672>&gt;</span> <span style=color:#66d9ef>for</span> Artifact {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>type</span> <span style=color:#a6e22e>Error</span> <span style=color:#f92672>=</span> serde_json::Error;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fn</span> <span style=color:#a6e22e>parse</span>(value: <span style=color:#66d9ef>&amp;</span><span style=color:#66d9ef>str</span>) -&gt; Result<span style=color:#f92672>&lt;</span>Self, Self::Error<span style=color:#f92672>&gt;</span> {
</span></span><span style=display:flex><span>        serde_json::from_str::<span style=color:#f92672>&lt;</span>Artifact<span style=color:#f92672>&gt;</span>(value)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#[cfg(test)]</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>mod</span> tests {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>use</span> <span style=color:#66d9ef>super</span>::<span style=color:#f92672>*</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>#[test]</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fn</span> <span style=color:#a6e22e>test_library</span>() {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>let</span> library <span style=color:#f92672>=</span> Library::parse(
</span></span><span style=display:flex><span>                <span style=color:#e6db74>r</span><span style=color:#e6db74>#&#34;{&#34;downloads&#34;: {&#34;artifact&#34;: {&#34;path&#34;: &#34;ca/weblite/java-objc-bridge/1.1/java-objc-bridge-1.1.jar&#34;, &#34;sha1&#34;: &#34;1227f9e0666314f9de41477e3ec277e542ed7f7b&#34;, &#34;size&#34;: 1330045, &#34;url&#34;: &#34;https://libraries.minecraft.net/ca/weblite/java-objc-bridge/1.1/java-objc-bridge-1.1.jar&#34;}}, &#34;name&#34;: &#34;ca.weblite:java-objc-bridge:1.1&#34;, &#34;rules&#34;: [{&#34;action&#34;: &#34;allow&#34;, &#34;os&#34;: {&#34;name&#34;: &#34;osx&#34;}}]}&#34;#</span>,
</span></span><span style=display:flex><span>            ).unwrap_or_else(<span style=color:#f92672>|</span>err<span style=color:#f92672>|</span> panic!(<span style=color:#e6db74>&#34;</span><span style=color:#e6db74>{:?}</span><span style=color:#e6db74>&#34;</span>,err));
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        assert_eq!(<span style=color:#e6db74>&#34;ca.weblite:java-objc-bridge:1.1&#34;</span>, library.name);
</span></span><span style=display:flex><span>        assert_eq!(
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#34;ca/weblite/java-objc-bridge/1.1/java-objc-bridge-1.1.jar&#34;</span>,
</span></span><span style=display:flex><span>            library.downloads.artifact.path
</span></span><span style=display:flex><span>        );
</span></span><span style=display:flex><span>        assert_eq!(
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#34;1227f9e0666314f9de41477e3ec277e542ed7f7b&#34;</span>,
</span></span><span style=display:flex><span>            library.downloads.artifact.sha1
</span></span><span style=display:flex><span>        );
</span></span><span style=display:flex><span>        assert_eq!(<span style=color:#ae81ff>1330045</span>, library.downloads.artifact.size);
</span></span><span style=display:flex><span>        assert_eq!(
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#34;https://libraries.minecraft.net/ca/weblite/java-objc-bridge/1.1/java-objc-bridge-1.1.jar&#34;</span>,
</span></span><span style=display:flex><span>            library.downloads.artifact.url
</span></span><span style=display:flex><span>        );
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>let</span> rules <span style=color:#f92672>=</span> <span style=color:#f92672>&amp;</span>library.rules.unwrap();
</span></span><span style=display:flex><span>        assert_eq!(<span style=color:#e6db74>&#34;allow&#34;</span>, rules[<span style=color:#ae81ff>0</span>].action);
</span></span><span style=display:flex><span>        assert_eq!(<span style=color:#e6db74>&#34;osx&#34;</span>, rules[<span style=color:#ae81ff>0</span>].os.name);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p><code>version_manifest.rs</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=display:flex><span><span style=color:#66d9ef>use</span> model::version_manifest::<span style=color:#f92672>*</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>use</span> <span style=color:#66d9ef>crate</span>::Parse;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>impl</span> Parse<span style=color:#f92672>&lt;&amp;</span><span style=color:#66d9ef>str</span><span style=color:#f92672>&gt;</span> <span style=color:#66d9ef>for</span> VersionManifest {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>type</span> <span style=color:#a6e22e>Error</span> <span style=color:#f92672>=</span> serde_json::Error;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fn</span> <span style=color:#a6e22e>parse</span>(value: <span style=color:#66d9ef>&amp;</span><span style=color:#66d9ef>str</span>) -&gt; Result<span style=color:#f92672>&lt;</span>Self, Self::Error<span style=color:#f92672>&gt;</span> {
</span></span><span style=display:flex><span>        serde_json::from_str::<span style=color:#f92672>&lt;</span>VersionManifest<span style=color:#f92672>&gt;</span>(value)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>impl</span> Parse<span style=color:#f92672>&lt;&amp;</span><span style=color:#66d9ef>str</span><span style=color:#f92672>&gt;</span> <span style=color:#66d9ef>for</span> Latest {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>type</span> <span style=color:#a6e22e>Error</span> <span style=color:#f92672>=</span> serde_json::Error;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fn</span> <span style=color:#a6e22e>parse</span>(value: <span style=color:#66d9ef>&amp;</span><span style=color:#66d9ef>str</span>) -&gt; Result<span style=color:#f92672>&lt;</span>Self, Self::Error<span style=color:#f92672>&gt;</span> {
</span></span><span style=display:flex><span>        serde_json::from_str::<span style=color:#f92672>&lt;</span>Latest<span style=color:#f92672>&gt;</span>(value)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>impl</span> Parse<span style=color:#f92672>&lt;&amp;</span><span style=color:#66d9ef>str</span><span style=color:#f92672>&gt;</span> <span style=color:#66d9ef>for</span> Version {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>type</span> <span style=color:#a6e22e>Error</span> <span style=color:#f92672>=</span> serde_json::Error;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fn</span> <span style=color:#a6e22e>parse</span>(value: <span style=color:#66d9ef>&amp;</span><span style=color:#66d9ef>str</span>) -&gt; Result<span style=color:#f92672>&lt;</span>Self, Self::Error<span style=color:#f92672>&gt;</span> {
</span></span><span style=display:flex><span>        serde_json::from_str::<span style=color:#f92672>&lt;</span>Version<span style=color:#f92672>&gt;</span>(value)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#[cfg(test)]</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>mod</span> tests {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>use</span> <span style=color:#66d9ef>super</span>::<span style=color:#f92672>*</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>#[test]</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fn</span> <span style=color:#a6e22e>test_version</span>() {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>let</span> version <span style=color:#f92672>=</span> Version::parse(
</span></span><span style=display:flex><span>            <span style=color:#e6db74>r</span><span style=color:#e6db74>#&#34;{&#34;id&#34;: &#34;1.21&#34;, &#34;type&#34;: &#34;release&#34;, &#34;url&#34;: &#34;https://piston-meta.mojang.com/v1/packages/177e49d3233cb6eac42f0495c0a48e719870c2ae/1.21.json&#34;, &#34;time&#34;: &#34;2024-06-13T08:32:38+00:00&#34;, &#34;releaseTime&#34;: &#34;2024-06-13T08:24:03+00:00&#34;}&#34;#</span>,
</span></span><span style=display:flex><span>        ).unwrap_or_else(<span style=color:#f92672>|</span>err<span style=color:#f92672>|</span> panic!(<span style=color:#e6db74>&#34;</span><span style=color:#e6db74>{:?}</span><span style=color:#e6db74>&#34;</span>,err));
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        assert_eq!(<span style=color:#e6db74>&#34;1.21&#34;</span>, version.id);
</span></span><span style=display:flex><span>        assert_eq!(<span style=color:#e6db74>&#34;release&#34;</span>, version.type_);
</span></span><span style=display:flex><span>        assert_eq!(<span style=color:#e6db74>&#34;https://piston-meta.mojang.com/v1/packages/177e49d3233cb6eac42f0495c0a48e719870c2ae/1.21.json&#34;</span>, version.url);
</span></span><span style=display:flex><span>        assert_eq!(<span style=color:#e6db74>&#34;2024-06-13T08:32:38+00:00&#34;</span>, version.time);
</span></span><span style=display:flex><span>        assert_eq!(<span style=color:#e6db74>&#34;2024-06-13T08:24:03+00:00&#34;</span>, version.release_time);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>#[test]</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fn</span> <span style=color:#a6e22e>test_latest</span>() {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>let</span> latest <span style=color:#f92672>=</span> Latest::parse(<span style=color:#e6db74>r</span><span style=color:#e6db74>#&#34;{&#34;release&#34;: &#34;1.21&#34;, &#34;snapshot&#34;: &#34;1.21&#34;}&#34;#</span>)
</span></span><span style=display:flex><span>            .unwrap_or_else(<span style=color:#f92672>|</span>err<span style=color:#f92672>|</span> panic!(<span style=color:#e6db74>&#34;</span><span style=color:#e6db74>{:?}</span><span style=color:#e6db74>&#34;</span>, err));
</span></span><span style=display:flex><span>        assert_eq!(<span style=color:#e6db74>&#34;1.21&#34;</span>, latest.release);
</span></span><span style=display:flex><span>        assert_eq!(<span style=color:#e6db74>&#34;1.21&#34;</span>, latest.snapshot);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>#[test]</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fn</span> <span style=color:#a6e22e>test_version_manifest</span>() {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>let</span> version_manifest <span style=color:#f92672>=</span>
</span></span><span style=display:flex><span>            VersionManifest::parse(<span style=color:#e6db74>r</span><span style=color:#e6db74>#&#34;{&#34;latest&#34;: {&#34;release&#34;: &#34;1.21&#34;, &#34;snapshot&#34;: &#34;1.21&#34;}, &#34;versions&#34;: [{&#34;id&#34;: &#34;1.21&#34;, &#34;type&#34;: &#34;release&#34;, &#34;url&#34;: &#34;https://piston-meta.mojang.com/v1/packages/177e49d3233cb6eac42f0495c0a48e719870c2ae/1.21.json&#34;, &#34;time&#34;: &#34;2024-06-13T08:32:38+00:00&#34;, &#34;releaseTime&#34;: &#34;2024-06-13T08:24:03+00:00&#34;}]}&#34;#</span>).unwrap_or_else(<span style=color:#f92672>|</span>err<span style=color:#f92672>|</span> panic!(<span style=color:#e6db74>&#34;</span><span style=color:#e6db74>{:?}</span><span style=color:#e6db74>&#34;</span>, err));
</span></span><span style=display:flex><span>        assert_eq!(<span style=color:#e6db74>&#34;1.21&#34;</span>, version_manifest.latest.release);
</span></span><span style=display:flex><span>        assert_eq!(<span style=color:#e6db74>&#34;1.21&#34;</span>, version_manifest.latest.snapshot);
</span></span><span style=display:flex><span>        assert_eq!(<span style=color:#e6db74>&#34;1.21&#34;</span>, version_manifest.versions[<span style=color:#ae81ff>0</span>].id);
</span></span><span style=display:flex><span>        assert_eq!(<span style=color:#e6db74>&#34;release&#34;</span>, version_manifest.versions[<span style=color:#ae81ff>0</span>].type_);
</span></span><span style=display:flex><span>        assert_eq!(<span style=color:#e6db74>&#34;https://piston-meta.mojang.com/v1/packages/177e49d3233cb6eac42f0495c0a48e719870c2ae/1.21.json&#34;</span>, version_manifest.versions[<span style=color:#ae81ff>0</span>].url);
</span></span><span style=display:flex><span>        assert_eq!(
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#34;2024-06-13T08:32:38+00:00&#34;</span>,
</span></span><span style=display:flex><span>            version_manifest.versions[<span style=color:#ae81ff>0</span>].time
</span></span><span style=display:flex><span>        );
</span></span><span style=display:flex><span>        assert_eq!(
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#34;2024-06-13T08:24:03+00:00&#34;</span>,
</span></span><span style=display:flex><span>            version_manifest.versions[<span style=color:#ae81ff>0</span>].release_time
</span></span><span style=display:flex><span>        );
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p><code>version.rs</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=display:flex><span><span style=color:#66d9ef>use</span> <span style=color:#66d9ef>crate</span>::Parse;
</span></span><span style=display:flex><span><span style=color:#66d9ef>use</span> model::version::<span style=color:#f92672>*</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>impl</span> Parse<span style=color:#f92672>&lt;&amp;</span><span style=color:#66d9ef>str</span><span style=color:#f92672>&gt;</span> <span style=color:#66d9ef>for</span> Version {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>type</span> <span style=color:#a6e22e>Error</span> <span style=color:#f92672>=</span> serde_json::Error;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fn</span> <span style=color:#a6e22e>parse</span>(value: <span style=color:#66d9ef>&amp;</span><span style=color:#66d9ef>str</span>) -&gt; Result<span style=color:#f92672>&lt;</span>Self, Self::Error<span style=color:#f92672>&gt;</span> {
</span></span><span style=display:flex><span>        serde_json::from_str::<span style=color:#f92672>&lt;</span>Version<span style=color:#f92672>&gt;</span>(value)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>impl</span> Parse<span style=color:#f92672>&lt;&amp;</span><span style=color:#66d9ef>str</span><span style=color:#f92672>&gt;</span> <span style=color:#66d9ef>for</span> Download {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>type</span> <span style=color:#a6e22e>Error</span> <span style=color:#f92672>=</span> serde_json::Error;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fn</span> <span style=color:#a6e22e>parse</span>(value: <span style=color:#66d9ef>&amp;</span><span style=color:#66d9ef>str</span>) -&gt; Result<span style=color:#f92672>&lt;</span>Self, Self::Error<span style=color:#f92672>&gt;</span> {
</span></span><span style=display:flex><span>        serde_json::from_str::<span style=color:#f92672>&lt;</span>Download<span style=color:#f92672>&gt;</span>(value)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>impl</span> Parse<span style=color:#f92672>&lt;&amp;</span><span style=color:#66d9ef>str</span><span style=color:#f92672>&gt;</span> <span style=color:#66d9ef>for</span> Client {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>type</span> <span style=color:#a6e22e>Error</span> <span style=color:#f92672>=</span> serde_json::Error;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fn</span> <span style=color:#a6e22e>parse</span>(value: <span style=color:#66d9ef>&amp;</span><span style=color:#66d9ef>str</span>) -&gt; Result<span style=color:#f92672>&lt;</span>Self, Self::Error<span style=color:#f92672>&gt;</span> {
</span></span><span style=display:flex><span>        serde_json::from_str::<span style=color:#f92672>&lt;</span>Client<span style=color:#f92672>&gt;</span>(value)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#[cfg(test)]</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>mod</span> tests {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>use</span> <span style=color:#66d9ef>super</span>::<span style=color:#f92672>*</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>#[test]</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fn</span> <span style=color:#a6e22e>test_version</span>() {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>let</span> game <span style=color:#f92672>=</span> Version::parse(
</span></span><span style=display:flex><span>            <span style=color:#e6db74>r</span><span style=color:#e6db74>#&#34;{&#34;downloads&#34;: {&#34;client&#34;: {&#34;sha1&#34;: &#34;0e9a07b9bb3390602f977073aa12884a4ce12431&#34;, &#34;size&#34;: 26836080, &#34;url&#34;: &#34;https://piston-data.mojang.com/v1/objects/0e9a07b9bb3390602f977073aa12884a4ce12431/client.jar&#34;}}, &#34;id&#34;: &#34;1.21&#34;, &#34;libraries&#34;: [], &#34;mainClass&#34;: &#34;net.minecraft.client.main.Main&#34;, &#34;releaseTime&#34;: &#34;2024-06-13T08:24:03+00:00&#34;, &#34;time&#34;: &#34;2024-06-13T08:32:38+00:00&#34;, &#34;type&#34;: &#34;release&#34;}&#34;#</span>,
</span></span><span style=display:flex><span>        ).unwrap_or_else(<span style=color:#f92672>|</span>err<span style=color:#f92672>|</span> panic!(<span style=color:#e6db74>&#34;</span><span style=color:#e6db74>{:?}</span><span style=color:#e6db74>&#34;</span>,err));
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>let</span> client <span style=color:#f92672>=</span> <span style=color:#f92672>&amp;</span>game.downloads.client;
</span></span><span style=display:flex><span>        assert_eq!(<span style=color:#e6db74>&#34;0e9a07b9bb3390602f977073aa12884a4ce12431&#34;</span>, client.sha1);
</span></span><span style=display:flex><span>        assert_eq!(<span style=color:#ae81ff>26836080</span>, client.size);
</span></span><span style=display:flex><span>        assert_eq!(<span style=color:#e6db74>&#34;https://piston-data.mojang.com/v1/objects/0e9a07b9bb3390602f977073aa12884a4ce12431/client.jar&#34;</span>, client.url);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        assert_eq!(<span style=color:#e6db74>&#34;1.21&#34;</span>, game.id);
</span></span><span style=display:flex><span>        assert_eq!(<span style=color:#e6db74>&#34;net.minecraft.client.main.Main&#34;</span>, game.main_class);
</span></span><span style=display:flex><span>        assert_eq!(<span style=color:#e6db74>&#34;2024-06-13T08:24:03+00:00&#34;</span>, game.release_time);
</span></span><span style=display:flex><span>        assert_eq!(<span style=color:#e6db74>&#34;2024-06-13T08:32:38+00:00&#34;</span>, game.time);
</span></span><span style=display:flex><span>        assert_eq!(<span style=color:#e6db74>&#34;release&#34;</span>, game.type_);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>最后我们将这些<code>tait</code>导出。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=display:flex><span><span style=color:#66d9ef>pub</span> <span style=color:#66d9ef>mod</span> asset;
</span></span><span style=display:flex><span><span style=color:#66d9ef>pub</span> <span style=color:#66d9ef>mod</span> library;
</span></span><span style=display:flex><span><span style=color:#66d9ef>pub</span> <span style=color:#66d9ef>mod</span> version;
</span></span><span style=display:flex><span><span style=color:#66d9ef>pub</span> <span style=color:#66d9ef>mod</span> version_manifest;
</span></span></code></pre></div><p><a href=https://github.com/Enaium/teaching-rust-minecraft-client-launch>项目地址</a></p></div><div class="d-flex justify-content-between"><a class=text-reset href=https://blog.enaium.cn/post/2024-6-30-rust%E5%85%A5%E9%97%A8%E5%AE%9E%E6%88%98-%E7%BC%96%E5%86%99minecraft%E5%90%AF%E5%8A%A8%E5%99%A8%232%E5%BB%BA%E7%AB%8B%E8%B5%84%E6%BA%90%E6%A8%A1%E5%9E%8B/>Rust入门实战 编写Minecraft启动器#2建立资源模型</a>
<a class=text-reset href=https://blog.enaium.cn/post/2024-7-5-rust%E5%85%A5%E9%97%A8%E5%AE%9E%E6%88%98-%E7%BC%96%E5%86%99minecraft%E5%90%AF%E5%8A%A8%E5%99%A8%234%E4%B8%8B%E8%BD%BD%E8%B5%84%E6%BA%90/>Rust入门实战 编写Minecraft启动器#4下载资源</a></div></div></div></div></div><footer class="p-5 bg-dark text-white text-center"><div class=container><p class=lead>Copyright &copy; 2024 Enaium</p></div></footer><script src=/js/bootstrap.bundle.min.js></script></body></html>