<!doctype html><html><head><meta charset=UTF-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><title>Java使用FFM API调用SDL</title>
<link rel=stylesheet href=/css/bootstrap.min.css><link rel=stylesheet href=/css/styles.css></head><body class="d-flex flex-column justify-content-between min-vh-100"><nav class="navbar navbar-expand-lg bg-light"><div class=container-fluid><a class=navbar-brand href=/><img src=/assets/github.svg alt=Logo width=30 height=24 class="d-inline-block align-text-top">
Enaium的博客
</a><button class=navbar-toggler type=button data-bs-toggle=collapse data-bs-target=#navbarNav aria-controls=navbarNav aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse" id=navbarNav><ul class=navbar-nav><li class=nav-item><a class=nav-link aria-current=page href=https://blog.enaium.cn/contact/>联系</a></li><li class=nav-item><a class=nav-link aria-current=page href=https://blog.enaium.cn/about/>关于</a></li><li class="nav-item dropdown"><a class="nav-link dropdown-toggle" data-bs-toggle=dropdown href=# role=button aria-expanded=false><img alt=Logo width=30 height=24 src=/assets/language.svg></a><ul class=dropdown-menu></ul></li></ul></div></div></nav><div style=flex:1><div class=container><div class=card><div class=card-header>Java使用FFM API调用SDL</div><div class=card-body><div class=card-text><p>首先我们需要创建一个<code>Gradle</code>项目，之后设置项目的<code>JDK</code>版本，设置为<code>22</code>及以上版本。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=display:flex><span>plugins {
</span></span><span style=display:flex><span>    kotlin(<span style=color:#e6db74>&#34;jvm&#34;</span>) version <span style=color:#e6db74>&#34;2.1.0&#34;</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>group = <span style=color:#e6db74>&#34;cn.enaium&#34;</span>
</span></span><span style=display:flex><span>version = <span style=color:#e6db74>&#34;1.0-SNAPSHOT&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>repositories {
</span></span><span style=display:flex><span>    mavenCentral()
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>dependencies {
</span></span><span style=display:flex><span>    testImplementation(kotlin(<span style=color:#e6db74>&#34;test&#34;</span>))
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>tasks.test {
</span></span><span style=display:flex><span>    useJUnitPlatform()
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>kotlin {
</span></span><span style=display:flex><span>    jvmToolchain(<span style=color:#ae81ff>23</span>)
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>接着我们在当前目录初始化<code>git</code>仓库，之后需要添加一个子模块。、</p><pre tabindex=0><code>git init
git submodule add git@github.com:libsdl-org/SDL.git SDL
</code></pre><p>之后编写生成接口的脚本，在这之前你必须安装<a href=https://cmake.org/>CMake</a>和<a href=https://jdk.java.net/jextract/><code>jextract</code></a>到环境变量中。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span>$sdl_path = <span style=color:#e6db74>&#34;SDL&#34;</span>
</span></span><span style=display:flex><span>mkdir <span style=color:#e6db74>&#34;</span>$sdl_path<span style=color:#e6db74>/build&#34;</span>; cmake -DCMAKE_BUILD_TYPE=Release <span style=color:#e6db74>&#34;</span>$sdl_path<span style=color:#e6db74>&#34;</span> -B <span style=color:#e6db74>&#34;</span>$sdl_path<span style=color:#e6db74>/build&#34;</span>; cmake --build <span style=color:#e6db74>&#34;</span>$sdl_path<span style=color:#e6db74>/build&#34;</span> --config Release --parallel
</span></span><span style=display:flex><span>jextract --include-dir <span style=color:#e6db74>&#34;</span>$sdl_path<span style=color:#e6db74>/include&#34;</span> --dump-includes <span style=color:#e6db74>&#34;</span>$sdl_path<span style=color:#e6db74>/build/includes.txt&#34;</span> <span style=color:#e6db74>&#34;</span>$sdl_path<span style=color:#e6db74>/include/SDL3/SDL.h&#34;</span>
</span></span><span style=display:flex><span>jextract --include-dir <span style=color:#e6db74>&#34;</span>$sdl_path<span style=color:#e6db74>/include&#34;</span> --output src/main/java --target-package org.libsdl --library SDL3 --use-system-load-library <span style=color:#e6db74>&#34;@</span>$sdl_path<span style=color:#e6db74>/build/includes.txt&#34;</span> <span style=color:#e6db74>&#34;</span>$sdl_path<span style=color:#e6db74>/include/SDL3/SDL.h&#34;</span>
</span></span></code></pre></div><p>首先是使用<code>CMake</code>编译<code>SDL</code>，之后使用<code>jextract</code>生成<code>Java</code>接口，之后运行脚本，这样就会在<code>src/main/java</code>生成<code>SDL3</code>的接口。</p><p>接着我们回到<code>build.gradle.kts</code>，添加<code>application</code>插件，之后将编译好的路径添加到启动参数中。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=display:flex><span>plugins {
</span></span><span style=display:flex><span>    application
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>application {
</span></span><span style=display:flex><span>    mainClass = <span style=color:#e6db74>&#34;MainKt&#34;</span>
</span></span><span style=display:flex><span>    applicationDefaultJvmArgs = listOf(<span style=color:#e6db74>&#34;-Djava.library.path=SDL/build/Release&#34;</span>, <span style=color:#e6db74>&#34;--enable-native-access=ALL-UNNAMED&#34;</span>)
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>之后就可以调用<code>SDL</code>的接口了。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=display:flex><span><span style=color:#66d9ef>import</span> org.libsdl.*
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> org.libsdl.SDL_h_1.*
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> java.lang.foreign.Arena
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @author Enaium
</span></span></span><span style=display:flex><span><span style=color:#75715e> */</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>main</span>() {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Arena</span>.ofConfined().use {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>val</span> init = SDL_h_2.SDL_Init(SDL_INIT_VIDEO() and SDL_INIT_EVENTS())
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (<span style=color:#f92672>!in</span><span style=color:#66d9ef>it</span>) {
</span></span><span style=display:flex><span>            println(<span style=color:#e6db74>&#34;SDL_Init Error: </span><span style=color:#e6db74>${SDL_h_3.SDL_GetError()}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>val</span> windowPtr = <span style=color:#66d9ef>it</span>.allocate(C_POINTER)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>val</span> rendererPtr = <span style=color:#66d9ef>it</span>.allocate(C_POINTER)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        SDL_CreateWindowAndRenderer(<span style=color:#66d9ef>it</span>.allocateFrom(<span style=color:#e6db74>&#34;Hello World&#34;</span>), <span style=color:#ae81ff>640</span>, <span style=color:#ae81ff>480</span>, <span style=color:#ae81ff>0</span>, windowPtr, rendererPtr)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>val</span> window = windowPtr.<span style=color:#66d9ef>get</span>(C_POINTER, <span style=color:#ae81ff>0</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>val</span> renderer = rendererPtr.<span style=color:#66d9ef>get</span>(C_POINTER, <span style=color:#ae81ff>0</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>val</span> rect = <span style=color:#a6e22e>SDL_FRect</span>.allocate(<span style=color:#66d9ef>it</span>)
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>SDL_FRect</span>.x(rect, <span style=color:#ae81ff>100f</span>)
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>SDL_FRect</span>.y(rect, <span style=color:#ae81ff>100f</span>)
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>SDL_FRect</span>.w(rect, <span style=color:#ae81ff>440f</span>)
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>SDL_FRect</span>.h(rect, <span style=color:#ae81ff>280f</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>val</span> event = <span style=color:#a6e22e>SDL_Event</span>.allocate(<span style=color:#66d9ef>it</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>var</span> quit = <span style=color:#66d9ef>false</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>while</span> (!quit) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>while</span> (SDL_PollEvent(event)) {
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>when</span> (<span style=color:#a6e22e>SDL_Event</span>.type(event)) {
</span></span><span style=display:flex><span>                    SDL_EVENT_QUIT() <span style=color:#f92672>-&gt;</span> {
</span></span><span style=display:flex><span>                        quit = <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>                    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                    SDL_EVENT_KEY_DOWN() <span style=color:#f92672>-&gt;</span> {
</span></span><span style=display:flex><span>                        <span style=color:#66d9ef>when</span> (<span style=color:#a6e22e>SDL_KeyboardEvent</span>.key(<span style=color:#a6e22e>SDL_Event</span>.key(event))) {
</span></span><span style=display:flex><span>                            SDLK_UP() <span style=color:#f92672>-&gt;</span> {
</span></span><span style=display:flex><span>                                <span style=color:#a6e22e>SDL_FRect</span>.y(rect, <span style=color:#a6e22e>SDL_FRect</span>.y(rect) - <span style=color:#ae81ff>5</span>)
</span></span><span style=display:flex><span>                            }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                            SDLK_DOWN() <span style=color:#f92672>-&gt;</span> {
</span></span><span style=display:flex><span>                                <span style=color:#a6e22e>SDL_FRect</span>.y(rect, <span style=color:#a6e22e>SDL_FRect</span>.y(rect) + <span style=color:#ae81ff>5</span>)
</span></span><span style=display:flex><span>                            }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                            SDLK_LEFT() <span style=color:#f92672>-&gt;</span> {
</span></span><span style=display:flex><span>                                <span style=color:#a6e22e>SDL_FRect</span>.x(rect, <span style=color:#a6e22e>SDL_FRect</span>.x(rect) - <span style=color:#ae81ff>5</span>)
</span></span><span style=display:flex><span>                            }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                            SDLK_RIGHT() <span style=color:#f92672>-&gt;</span> {
</span></span><span style=display:flex><span>                                <span style=color:#a6e22e>SDL_FRect</span>.x(rect, <span style=color:#a6e22e>SDL_FRect</span>.x(rect) + <span style=color:#ae81ff>5</span>)
</span></span><span style=display:flex><span>                            }
</span></span><span style=display:flex><span>                        }
</span></span><span style=display:flex><span>                    }
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            SDL_h_2.SDL_SetRenderDrawColor(renderer, <span style=color:#ae81ff>33.</span>toByte(), <span style=color:#ae81ff>33.</span>toByte(), <span style=color:#ae81ff>33.</span>toByte(), <span style=color:#ae81ff>255.</span>toByte())
</span></span><span style=display:flex><span>            SDL_h_2.SDL_RenderClear(renderer)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            SDL_h_2.SDL_SetRenderDrawColor(renderer, <span style=color:#ae81ff>0.</span>toByte(), <span style=color:#ae81ff>0.</span>toByte(), <span style=color:#ae81ff>255.</span>toByte(), <span style=color:#ae81ff>255.</span>toByte())
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            SDL_h_2.SDL_RenderFillRect(renderer, rect)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            SDL_h_2.SDL_RenderPresent(renderer)
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        SDL_h_2.SDL_DestroyRenderer(renderer)
</span></span><span style=display:flex><span>        SDL_h_3.SDL_DestroyWindow(window)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>首先这里创建了一个窗口和渲染器，还渲染了一个矩形。之后做了事件处理，关闭的时候跳出循环，之后销毁窗口和渲染器。按下键盘上下左右键可以移动矩形。</p><p>之后调用<code>./gradlew run</code>就可以运行程序了。</p><p><img src=https://s2.loli.net/2025/01/24/5J7FOMwGSIeQVz4.gif alt></p></div></div></div></div></div><footer class="p-5 bg-dark text-white text-center"><div class=container><p class=lead>Copyright &copy; 2024 Enaium</p></div></footer><script src=/js/bootstrap.bundle.min.js></script></body></html>