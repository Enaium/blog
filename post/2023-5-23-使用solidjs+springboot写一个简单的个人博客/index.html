<!doctype html><html><head><meta charset=UTF-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><title>使用SolidJS+SpringBoot写一个简单的个人博客</title>
<link rel=stylesheet href=/css/bootstrap.min.css><link rel=stylesheet href=/css/styles.css></head><body class="d-flex flex-column justify-content-between min-vh-100"><nav class="navbar navbar-expand-lg bg-light"><div class=container-fluid><a class=navbar-brand href=/><img src=/assets/github.svg alt=Logo width=30 height=24 class="d-inline-block align-text-top">
Enaium的博客
</a><button class=navbar-toggler type=button data-bs-toggle=collapse data-bs-target=#navbarNav aria-controls=navbarNav aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse" id=navbarNav><ul class=navbar-nav><li class=nav-item><a class=nav-link aria-current=page href=https://blog.enaium.cn/contact/>联系</a></li><li class=nav-item><a class=nav-link aria-current=page href=https://blog.enaium.cn/about/>关于</a></li><li class="nav-item dropdown"><a class="nav-link dropdown-toggle" data-bs-toggle=dropdown href=# role=button aria-expanded=false><img alt=Logo width=30 height=24 src=/assets/language.svg></a><ul class=dropdown-menu></ul></li></ul></div></div></nav><div style=flex:1><div class=container><div class=card><div class=card-header>使用SolidJS+SpringBoot写一个简单的个人博客</div><div class=card-body><div class=card-text><h2 id=前言>前言</h2><p>前端我们使用了<code>SolidJS</code>来进行开发,它是一个新出的前端框架,它的特点是使用<code>React Hooks</code>的方式来进行开发,并且它的<code>API</code>和<code>React</code>的<code>API</code>非常相似,所以如果你会<code>React</code>的话,那么你就会<code>SolidJS</code>.</p><p>后端我们使用了<code>SpringBoot</code>来进行开发,数据库我们使用了<code>MySQL</code>来进行开发,这里我使用的是<code>MariaDB</code>来进行开发,ORM 框架使用的是<code>Jimmer</code>,这个框架它支持<code>Java</code>和<code>Kotlin</code>,这里为了简单起见就使用<code>Java</code>开发,但实际使用<code>Koltin</code>会更方便.</p><h2 id=前端环境>前端环境</h2><p>首先呢,需要安装一下<code>SolidJS</code>的模板,这里我使用的是<code>TypeScript</code>和<code>Bootstrap</code>的模板</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>npx degit solidjs/templates/ts-bootstrap website
</span></span><span style=display:flex><span>cd website
</span></span><span style=display:flex><span>pmpm install <span style=color:#75715e># or npm install</span>
</span></span><span style=display:flex><span>pmpm dev <span style=color:#75715e># or npm run dev</span>
</span></span></code></pre></div><p>然后我们需要安装一下<code>SolidJS</code>的路由,这是一个官方的路由</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pnpm install @solidjs/router
</span></span></code></pre></div><p>然后我们需要安装一下<code>SolidJS</code>的状态管理,这里我使用的是<code>zustand</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pnpm install zustand solid-zustand
</span></span></code></pre></div><p>然后我们需要安装一下<code>Immer</code>用于修改不可变数据</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pnpm install solid-immer
</span></span></code></pre></div><p>然后我们需要安装<code>solid-toast</code>,这是一个用于显示提示的库</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pnpm install solid-toast
</span></span></code></pre></div><p>最后我们需要安装<code>TanStack Query</code>,这是一个用于进行网络请求的库,同时支持<code>React</code>,<code>Vue</code>,<code>Svelte</code>当然也支持<code>SolidJS</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pnpm install @tanstack/solid-query
</span></span></code></pre></div><h3 id=编写前端基础代码>编写前端基础代码</h3><p>现在我们开始编写前端代码</p><p>首先我们需要删掉模板中自带的样式,并且删除<code>App.tsx</code>中的内容,然后我们需要在<code>App.tsx</code>中引入<code>Router</code>组件,并且使用<code>useRoutes</code>来进行路由的渲染,这里我们需要传入一个路由数组,这个数组中包含了我们的路由信息,然后我们需要在<code>App.tsx</code>中使用<code>Router</code>组件来进行路由的渲染</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-tsx data-lang=tsx><span style=display:flex><span><span style=color:#66d9ef>import</span> <span style=color:#66d9ef>type</span> { <span style=color:#a6e22e>Component</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#34;solid-js&#34;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>Router</span>, <span style=color:#a6e22e>useRoutes</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#34;@solidjs/router&#34;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> <span style=color:#a6e22e>routes</span> <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#34;./router&#34;</span> <span style=color:#75715e>//这里是路由数组
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>Toaster</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#34;solid-toast&#34;</span> <span style=color:#75715e>//这个组件用于显示提示
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>App</span>: <span style=color:#66d9ef>Component</span> <span style=color:#f92672>=</span> () <span style=color:#f92672>=&gt;</span> {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>Routes</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>useRoutes</span>(<span style=color:#a6e22e>routes</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> (
</span></span><span style=display:flex><span>    &lt;&gt;
</span></span><span style=display:flex><span>      &lt;<span style=color:#f92672>Toaster</span> /&gt;
</span></span><span style=display:flex><span>      &lt;<span style=color:#f92672>Router</span>&gt;
</span></span><span style=display:flex><span>        &lt;<span style=color:#f92672>Routes</span> /&gt;
</span></span><span style=display:flex><span>      &lt;/<span style=color:#f92672>Router</span>&gt;
</span></span><span style=display:flex><span>    &lt;/&gt;
</span></span><span style=display:flex><span>  )
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>之后新建<code>views</code>目录,在其中新家一个<code>Login.tsx</code>文件,这个文件用于渲染登录页面,然后我们需要在路由数组中添加这个路由,路由文件就是在<code>src</code>目录下新建一个<code>router</code>目录,然后在其中新建一个<code>index.ts</code>文件,这个文件用于导出路由数组</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-tsx data-lang=tsx><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>RouteDefinition</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#34;@solidjs/router&#34;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> <span style=color:#a6e22e>Login</span> <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#34;../views/Login&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>routes</span>: <span style=color:#66d9ef>RouteDefinition</span>[] <span style=color:#f92672>=</span> [
</span></span><span style=display:flex><span>  {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>path</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;/login&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>component</span><span style=color:#f92672>:</span> () <span style=color:#f92672>=&gt;</span> &lt;<span style=color:#f92672>Login</span> /&gt; <span style=color:#75715e>//这里有个坑,如果不加上() =&gt;,那么会报错,也可以直接使用Login比如component: Login
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  }
</span></span><span style=display:flex><span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>default</span> <span style=color:#a6e22e>routes</span>
</span></span></code></pre></div><p>好了现在来写用户的<code>session</code>状态的管理,我们需要在<code>src</code>目录下新建一个<code>store</code>目录,然后在其中新建一个<code>index.ts</code>文件,这个文件用于导出<code>session</code>状态</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-tsx data-lang=tsx><span style=display:flex><span><span style=color:#66d9ef>import</span> <span style=color:#a6e22e>create</span> <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#34;solid-zustand&#34;</span> <span style=color:#75715e>//需要注意的是这里使用的是solid-zustand,而不是zustand
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>persist</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#34;zustand/middleware&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>//这里定义了session的类型
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>interface</span> <span style=color:#a6e22e>Session</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>token?</span>: <span style=color:#66d9ef>string</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>id?</span>: <span style=color:#66d9ef>string</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>setToken</span><span style=color:#f92672>:</span> (<span style=color:#a6e22e>token</span>: <span style=color:#66d9ef>string</span>) <span style=color:#f92672>=&gt;</span> <span style=color:#66d9ef>void</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>setId</span><span style=color:#f92672>:</span> (<span style=color:#a6e22e>id</span>: <span style=color:#66d9ef>string</span>) <span style=color:#f92672>=&gt;</span> <span style=color:#66d9ef>void</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>//这里使用zustand的persist中间件来进行持久化
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>useSessionStore</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>create</span>(
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>persist</span>&lt;<span style=color:#f92672>Session</span>&gt;(
</span></span><span style=display:flex><span>    (<span style=color:#66d9ef>set</span>, <span style=color:#66d9ef>get</span>) <span style=color:#f92672>=&gt;</span> ({
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>setToken</span><span style=color:#f92672>:</span> (<span style=color:#a6e22e>token</span>: <span style=color:#66d9ef>string</span>) <span style=color:#f92672>=&gt;</span> <span style=color:#66d9ef>set</span>({ <span style=color:#a6e22e>token</span> }),
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>setId</span><span style=color:#f92672>:</span> (<span style=color:#a6e22e>id</span>: <span style=color:#66d9ef>string</span>) <span style=color:#f92672>=&gt;</span> <span style=color:#66d9ef>set</span>({ <span style=color:#a6e22e>id</span> })
</span></span><span style=display:flex><span>    }),
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>name</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;session-store&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>getStorage</span><span style=color:#f92672>:</span> () <span style=color:#f92672>=&gt;</span> <span style=color:#a6e22e>localStorage</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  )
</span></span><span style=display:flex><span>)
</span></span></code></pre></div><h2 id=后端环境>后端环境</h2><p>首先打开<code>IntelliJ IDEA</code>然后选择<code>Spring Initializr</code>,语言选择<code>Java</code>,构建工具选择<code>Gradle</code>,脚本使用<code>Kotlin</code>,因为<code>kts</code>比<code>groovy</code>更好用,剩下的自己看着改改,<code>JDK</code>使用<code>17</code>,因为<code>SpringBoot3</code>只能使用<code>JDK17</code>,然后点击<code>Next</code>,依赖选择<code>SpringWeb</code>,<code>MariaDB Driver</code>,<code>Lombok</code>,上面这些步骤使用<code>start.spring.io</code>也可以完成,然后点击<code>Create</code>,然后等待<code>Gradle</code>下载依赖,下载完成后就可以开始编写代码了</p><p>首先引入<code>Jimmer</code>的相关依赖</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=display:flex><span>dependencies {
</span></span><span style=display:flex><span>implementation(<span style=color:#e6db74>&#34;org.babyfish.jimmer:jimmer-spring-boot-starter:0.7.67&#34;</span>)<span style=color:#75715e>//这个是Jimmer的SpringBoot的Starter
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>annotationProcessor(<span style=color:#e6db74>&#34;org.babyfish.jimmer:jimmer-apt:0.7.67&#34;</span>)<span style=color:#75715e>//这个是Jimmer的APT,用于生成代码
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>}
</span></span></code></pre></div><p>接着引入<code>SaToken</code>的依赖</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=display:flex><span>implementation(<span style=color:#e6db74>&#34;cn.dev33:sa-token-spring-boot3-starter:1.34.0&#34;</span>)
</span></span></code></pre></div><p>然后我们需要在<code>application.properties</code>中配置一下所需要的配置</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-properties data-lang=properties><span style=display:flex><span><span style=color:#75715e>#数据库配置,这里使用的是MariaDB,因为我的数据库在虚拟机中,所以这里使用的是虚拟机的IP地址</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>spring.datasource.driver-class-name</span><span style=color:#f92672>=</span><span style=color:#e6db74>org.mariadb.jdbc.Driver</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>spring.datasource.username</span><span style=color:#f92672>=</span><span style=color:#e6db74>root</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>spring.datasource.password</span><span style=color:#f92672>=</span><span style=color:#e6db74>root</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>spring.datasource.url</span><span style=color:#f92672>=</span><span style=color:#e6db74>jdbc:mariadb://192.168.56.101:3306/blog</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#Jimmer配置,这里配置了生成Typescript的路径,以及是否显示SQL语句,以及是否美化SQL语句</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>jimmer.client.ts.path</span><span style=color:#f92672>=</span><span style=color:#e6db74>/typescript.zip</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>jimmer.show-sql</span><span style=color:#f92672>=</span><span style=color:#e6db74>true</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>jimmer.pretty-sql</span><span style=color:#f92672>=</span><span style=color:#e6db74>true</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#SaToken配置,这里配置了token的名称</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>sa-token.token-name</span><span style=color:#f92672>=</span><span style=color:#e6db74>token</span>
</span></span></code></pre></div><p>需要注意一下,<code>IntelliJ IDEA</code>默认对<code>properties</code>文件的编码是<code>ISO-8859-1</code>,所以我们需要修改一下编码,修改方法是在<code>File</code>-><code>Settings</code>-><code>Editor</code>-><code>File Encodings</code>中修改<code>Default encoding for properties files</code>的编码为<code>UTF-8</code>,要不然中文会乱码</p><h3 id=设计数据库>设计数据库</h3><p>首先一个简单的个人博客包括了文章,评论,用户,分类</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#66d9ef>create</span> <span style=color:#66d9ef>table</span> blog.category
</span></span><span style=display:flex><span>(
</span></span><span style=display:flex><span>    id   uuid        <span style=color:#66d9ef>not</span> <span style=color:#66d9ef>null</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>primary</span> <span style=color:#66d9ef>key</span>,
</span></span><span style=display:flex><span>    name varchar(<span style=color:#ae81ff>32</span>) <span style=color:#66d9ef>not</span> <span style=color:#66d9ef>null</span>
</span></span><span style=display:flex><span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>create</span> <span style=color:#66d9ef>table</span> blog.<span style=color:#66d9ef>user</span>
</span></span><span style=display:flex><span>(
</span></span><span style=display:flex><span>    id       uuid        <span style=color:#66d9ef>not</span> <span style=color:#66d9ef>null</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>primary</span> <span style=color:#66d9ef>key</span>,
</span></span><span style=display:flex><span>    username varchar(<span style=color:#ae81ff>18</span>) <span style=color:#66d9ef>not</span> <span style=color:#66d9ef>null</span>,
</span></span><span style=display:flex><span>    password varchar(<span style=color:#ae81ff>18</span>) <span style=color:#66d9ef>not</span> <span style=color:#66d9ef>null</span>
</span></span><span style=display:flex><span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>create</span> <span style=color:#66d9ef>table</span> blog.post
</span></span><span style=display:flex><span>(
</span></span><span style=display:flex><span>    id          uuid        <span style=color:#66d9ef>not</span> <span style=color:#66d9ef>null</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>primary</span> <span style=color:#66d9ef>key</span>,
</span></span><span style=display:flex><span>    user_id     uuid        <span style=color:#66d9ef>not</span> <span style=color:#66d9ef>null</span>,
</span></span><span style=display:flex><span>    category_id uuid        <span style=color:#66d9ef>not</span> <span style=color:#66d9ef>null</span>,
</span></span><span style=display:flex><span>    title       varchar(<span style=color:#ae81ff>50</span>) <span style=color:#66d9ef>not</span> <span style=color:#66d9ef>null</span>,
</span></span><span style=display:flex><span>    content     text        <span style=color:#66d9ef>not</span> <span style=color:#66d9ef>null</span>,
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>constraint</span> post_category_id_fk
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>foreign</span> <span style=color:#66d9ef>key</span> (category_id) <span style=color:#66d9ef>references</span> blog.category (id),
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>constraint</span> post_user_id_fk
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>foreign</span> <span style=color:#66d9ef>key</span> (user_id) <span style=color:#66d9ef>references</span> blog.<span style=color:#66d9ef>user</span> (id)
</span></span><span style=display:flex><span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>create</span> <span style=color:#66d9ef>table</span> blog.reply
</span></span><span style=display:flex><span>(
</span></span><span style=display:flex><span>    id      uuid          <span style=color:#66d9ef>not</span> <span style=color:#66d9ef>null</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>primary</span> <span style=color:#66d9ef>key</span>,
</span></span><span style=display:flex><span>    user_id uuid          <span style=color:#66d9ef>not</span> <span style=color:#66d9ef>null</span>,
</span></span><span style=display:flex><span>    post_id uuid          <span style=color:#66d9ef>not</span> <span style=color:#66d9ef>null</span>,
</span></span><span style=display:flex><span>    content varchar(<span style=color:#ae81ff>1000</span>) <span style=color:#66d9ef>not</span> <span style=color:#66d9ef>null</span>,
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>constraint</span> reply_post_id_fk
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>foreign</span> <span style=color:#66d9ef>key</span> (post_id) <span style=color:#66d9ef>references</span> blog.post (id),
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>constraint</span> reply_user_id_fk
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>foreign</span> <span style=color:#66d9ef>key</span> (user_id) <span style=color:#66d9ef>references</span> blog.<span style=color:#66d9ef>user</span> (id)
</span></span><span style=display:flex><span>);
</span></span></code></pre></div><h2 id=后端编写>后端编写</h2><h3 id=定义实体类>定义实体类</h3><p>在<code>Jimmer</code>中定义实体类需要使用接口,如果你使用的是自增主键,那么你需要使用<code>@GeneratedValue(strategy = GenerationType.IDENTITY)</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#f92672>import</span> org.babyfish.jimmer.sql.Entity;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.babyfish.jimmer.sql.GeneratedValue;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.babyfish.jimmer.sql.Id;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.babyfish.jimmer.sql.Table;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.babyfish.jimmer.sql.meta.UUIDIdGenerator;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.jetbrains.annotations.NotNull;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Entity</span><span style=color:#75715e>//这个注解用于标记这个接口是一个实体类</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Table</span>(name <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;user&#34;</span>)<span style=color:#75715e>//如果表名比较特殊,那么可以使用这个注解来指定表名</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>interface</span> <span style=color:#a6e22e>User</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Id</span><span style=color:#75715e>//这个注解用于标记这个属性是主键</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@GeneratedValue</span>(generatorType <span style=color:#f92672>=</span> UUIDIdGenerator.<span style=color:#a6e22e>class</span>)<span style=color:#75715e>//这个注解用于标记这个属性的值是自动生成的,这里使用的是UUID</span>
</span></span><span style=display:flex><span>    UUID <span style=color:#a6e22e>id</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@NotNull</span><span style=color:#75715e>//这个注解用于标记这个属性的值不可为空,推荐使用Jetbrains的注解</span>
</span></span><span style=display:flex><span>    String <span style=color:#a6e22e>username</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@NotNull</span>
</span></span><span style=display:flex><span>    String <span style=color:#a6e22e>password</span>();
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>接着定义其他的实体类</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@Entity</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Table</span>(name <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;category&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>interface</span> <span style=color:#a6e22e>Category</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Id</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@GeneratedValue</span>(generatorType <span style=color:#f92672>=</span> UUIDIdGenerator.<span style=color:#a6e22e>class</span>)
</span></span><span style=display:flex><span>    UUID <span style=color:#a6e22e>id</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    String <span style=color:#a6e22e>name</span>();
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@Entity</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Table</span>(name <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;post&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>interface</span> <span style=color:#a6e22e>Post</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Id</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@GeneratedValue</span>(generatorType <span style=color:#f92672>=</span> UUIDIdGenerator.<span style=color:#a6e22e>class</span>)
</span></span><span style=display:flex><span>    UUID <span style=color:#a6e22e>id</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    UUID <span style=color:#a6e22e>userId</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    UUID <span style=color:#a6e22e>categoryId</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@NotNull</span>
</span></span><span style=display:flex><span>    String <span style=color:#a6e22e>title</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@NotNull</span>
</span></span><span style=display:flex><span>    String <span style=color:#a6e22e>content</span>();
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@Entity</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Table</span>(name <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;reply&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>interface</span> <span style=color:#a6e22e>Reply</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Id</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@GeneratedValue</span>(generatorType <span style=color:#f92672>=</span> UUIDIdGenerator.<span style=color:#a6e22e>class</span>)
</span></span><span style=display:flex><span>    UUID <span style=color:#a6e22e>id</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    UUID <span style=color:#a6e22e>userId</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    UUID <span style=color:#a6e22e>postId</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@NotNull</span>
</span></span><span style=display:flex><span>    String <span style=color:#a6e22e>content</span>();
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>定义好实体类之后需要运行一下项目,这样<code>Jimmer</code>就会生成代码,<code>Draft</code>,<code>Fetcher</code>,<code>Props</code>,<code>Table</code>和<code>TableEx</code>之类的,找到项目下的<code>build/generated/sources/annotationProcessor</code>位置,你就会发现这些生成的代码,如果使用的是<code>Kotlin</code>生成的类会和这些有点不同,但本篇文章使用的是<code>Java</code>,所以就不多说了,因为虽然本质上一样,但还是有点不同的</p><p>如果你使用的是 Linux 环境,那么你可以像我一样为每个实体类加上一个<code>Table</code>注解,那是因为<code>Linux</code>的名称是区分大小写的,而<code>Windows</code>的名称是不区分大小写的,<code>Jimmer</code>默认是会将所有的名称转换为大写,你也可以直接使用配置来修改这个行为</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@Bean</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> DatabaseNamingStrategy <span style=color:#a6e22e>databaseNamingStrategy</span>() {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> DefaultDatabaseNamingStrategy.<span style=color:#a6e22e>LOWER_CASE</span>;<span style=color:#75715e>//这里使用的是小写</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=定义-repository>定义 Repository</h3><p><code>Jimmer</code>和<code>JPA</code>一样,同样拥有<code>Repository</code>,因为<code>Jimmer</code>同时支持<code>Java</code>和<code>Kotlin</code>,所以这里的<code>Repository</code>是<code>JRepository</code>,这个接口继承了<code>JPA</code>的<code>JpaRepository</code>,所以它拥有<code>JPA</code>的所有功能,泛型的第一个参数是实体类的类型,第二个参数是主键的类型,这里我的主键使用的是<code>UUID</code>,所以这里的类型是<code>UUID</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#f92672>import</span> cn.enaium.blog.model.entity.User;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.babyfish.jimmer.spring.repository.JRepository;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.springframework.stereotype.Repository;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> java.util.UUID;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Repository</span><span style=color:#75715e>//这个注解用于标记这个接口是一个Repository,这个注解是SpringData提供的,也可以不用这个注解,SpringBoot会自动扫描这个接口</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>interface</span> <span style=color:#a6e22e>UserRepository</span> <span style=color:#66d9ef>extends</span> JRepository<span style=color:#f92672>&lt;</span>User, UUID<span style=color:#f92672>&gt;</span> {
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>接着定义其他的<code>Repository</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@Repository</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>interface</span> <span style=color:#a6e22e>CategoryRepository</span> <span style=color:#66d9ef>extends</span> JRepository<span style=color:#f92672>&lt;</span>Category, UUID<span style=color:#f92672>&gt;</span> {
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@Repository</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>interface</span> <span style=color:#a6e22e>PostRepository</span> <span style=color:#66d9ef>extends</span> JRepository<span style=color:#f92672>&lt;</span>Post, UUID<span style=color:#f92672>&gt;</span> {
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@Repository</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>interface</span> <span style=color:#a6e22e>ReplyRepository</span> <span style=color:#66d9ef>extends</span> JRepository<span style=color:#f92672>&lt;</span>Reply, UUID<span style=color:#f92672>&gt;</span> {
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>现在最基本的代码就写完了,还有一部分没有写,之后一遍写<code>Controller</code>时再写,现在我们需要编写一下<code>Controller</code>的代码</p><h3 id=编写-controller>编写 Controller</h3><h4 id=sessioncontroller>SessionController</h4><p><code>SessionController</code>用来处理用户的登录和和退出登录</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@RestController</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>SessionController</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@PutMapping</span>(<span style=color:#e6db74>&#34;/sessions/&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>login</span>() {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@DeleteMapping</span>(<span style=color:#e6db74>&#34;/sessions/&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>logout</span>() {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>既然要登录,那么就需要一个登录的请求体,这里我使用的是<code>JSON</code>来进行传输,所以我们需要定义一个<code>UserInput</code>类,这个类用于接收<code>JSON</code>数据</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@Data</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>UserInput</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Nullable</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>final</span> UUID id;
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Nullable</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>final</span> String username;
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Nullable</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>final</span> String password;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>接着将<code>UserRepository</code>注入到<code>SessionController</code>中</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@AllArgsConstructor</span><span style=color:#75715e>//这个注解用于标记这个类的构造函数是全参构造函数,这个注解是Lombok提供的</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>SessionController</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>final</span> UserRepository userRepository;<span style=color:#75715e>//这里使用的是构造函数注入,也可以使用字段注入,但是不推荐使用字段注入</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>首先要在<code>UserRepository</code>中编写一个<code>findByUsername</code>方法,这个方法用于根据用户名查询用户</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@Repository</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>interface</span> <span style=color:#a6e22e>UserRepository</span> <span style=color:#66d9ef>extends</span> JRepository<span style=color:#f92672>&lt;</span>User, UUID<span style=color:#f92672>&gt;</span> {
</span></span><span style=display:flex><span>    User <span style=color:#a6e22e>findByUsername</span>(String username);<span style=color:#75715e>//这里的方法名是有规则的,如果是根据用户名查询,那么方法名就是findByUsername,如果是根据用户名和密码查询,那么方法名就是findByUsernameAndPassword</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>然后我们需要在<code>SessionController</code>中编写<code>login</code>方法,简单的登录逻辑,如果用户不存在,那么就抛出一个<code>NullPointerException</code>,如果密码错误,那么就抛出一个<code>IllegalArgumentException</code>,如果登录成功,那么就返回一个<code>LoginResponse</code>对象,这个对象包含了<code>token</code>和<code>id</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@PutMapping</span>(<span style=color:#e6db74>&#34;/sessions/&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> LoginResponse <span style=color:#a6e22e>login</span>(<span style=color:#a6e22e>@RequestBody</span> UserInput userInput) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>final</span> <span style=color:#66d9ef>var</span> user <span style=color:#f92672>=</span> userRepository.<span style=color:#a6e22e>findByUsername</span>(userInput.<span style=color:#a6e22e>getUsername</span>());
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (user <span style=color:#f92672>==</span> <span style=color:#66d9ef>null</span>) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> NullPointerException(<span style=color:#e6db74>&#34;User not found&#34;</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span>user.<span style=color:#a6e22e>password</span>().<span style=color:#a6e22e>equals</span>(userInput.<span style=color:#a6e22e>getPassword</span>())) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> IllegalArgumentException(<span style=color:#e6db74>&#34;Password error&#34;</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>new</span> LoginResponse(StpUtil.<span style=color:#a6e22e>createLoginSession</span>(user.<span style=color:#a6e22e>id</span>()), user.<span style=color:#a6e22e>id</span>());
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@Data</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>LoginResponse</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>final</span> String token;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>final</span> UUID id;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>然后我们需要编写<code>logout</code>方法,这个方法用于退出登录,这个方法很简单,就是调用<code>SaToken</code>的<code>logout</code>方法</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@DeleteMapping</span>(<span style=color:#e6db74>&#34;/sessions/&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>logout</span>() {
</span></span><span style=display:flex><span>    StpUtil.<span style=color:#a6e22e>logout</span>();
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h4 id=usercontroller>UserController</h4><p>接着我们需要编写<code>UserController</code>,这个类用于处理用户的注册</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@RestController</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@AllArgsConstructor</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>UserController</span> {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>final</span> UserRepository userRepository;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@PutMapping</span>(<span style=color:#e6db74>&#34;/users/&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@ResponseStatus</span>(HttpStatus.<span style=color:#a6e22e>OK</span>)<span style=color:#75715e>//这个注解用于标记这个方法的响应状态码,这个注解是Spring提供的</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>register</span>(<span style=color:#a6e22e>@RequestBody</span> UserInput userInput) {
</span></span><span style=display:flex><span>        <span style=color:#75715e>//如果用户已经存在,那么就抛出一个异常</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (userRepository.<span style=color:#a6e22e>findByUsername</span>(userInput.<span style=color:#a6e22e>getUsername</span>()) <span style=color:#f92672>!=</span> <span style=color:#66d9ef>null</span>) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> IllegalArgumentException(<span style=color:#e6db74>&#34;User already exists&#34;</span>);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>//插入用户,这里使用的是Jimmer的UserDraft,这个类用于创建一个User对象,这个对象是一个Draft对象,这个对象可以修改,因为在Jimmer中实体类是不可变的,所以需要使用Draft,对于使用过Immer的人来说,这个Draft就是一个Immer的Draft,这里使用的是produce方法,这个方法用于创建一个Draft对象,这个方法的参数是一个Consumer,这个Consumer用于修改Draft对象,这里Jimmer借鉴了Immer</span>
</span></span><span style=display:flex><span>        userRepository.<span style=color:#a6e22e>insert</span>(UserDraft.<span style=color:#a6e22e>$</span>.<span style=color:#a6e22e>produce</span>(draft <span style=color:#f92672>-&gt;</span> {
</span></span><span style=display:flex><span>            draft.<span style=color:#a6e22e>setUsername</span>(userInput.<span style=color:#a6e22e>getUsername</span>());
</span></span><span style=display:flex><span>            draft.<span style=color:#a6e22e>setPassword</span>(userInput.<span style=color:#a6e22e>getPassword</span>());
</span></span><span style=display:flex><span>        }));
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h4 id=categorycontroller>CategoryController</h4><p>然后我们需要编写<code>CategoryController</code>,这个类用于处理分类的查询</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@RestController</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@AllArgsConstructor</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>CategoryController</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>final</span> CategoryRepository categoryRepository;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@GetMapping</span>(<span style=color:#e6db74>&#34;/categories/&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> List<span style=color:#f92672>&lt;</span>Category<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>findCategories</span>() {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> categoryRepository.<span style=color:#a6e22e>findAll</span>();
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h4 id=postcontroller>PostController</h4><p>然后我们需要编写<code>PostController</code>,这个类用于处理文章的查询,这里会使用<code>Jimmer</code>的<code>Fetcher</code>功能,这个功能用于查询关联表的数据,这里我们需要查询文章的分类,所以需要使用<code>Fetcher</code>功能</p><p>首先定义<code>PostInput</code>类,这个类用于接收<code>JSON</code>数据</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@Data</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>PostInput</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Nullable</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>final</span> UUID id;
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Nullable</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>final</span> String title;
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Nullable</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>final</span> String content;
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Nullable</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>final</span> UUID categoryId;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>接着设置表的关联关系,表的关联在表的实体类中进行设置,需要注意的是,关联建立后,之前生成的代码是不会更新的,所以需要手动更新一下,这里我使用的是<code>IntelliJ IDEA</code>的<code>Rebuild Project</code>功能,这个功能会重新生成代码,或者使用<code>Gradle</code>的<code>build</code>功能也可以,这里我使用的是<code>IntelliJ IDEA</code>的<code>Rebuild Project</code>功能</p><p>首先<code>Post</code>表和<code>Category</code>表是多对一的关系,所以在<code>Post</code>表中设置一个<code>category</code>方法,之后再<code>Category</code>实体类中定义一个<code>posts</code>方法,这个方法表示这个分类下的所有文章</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@Entity</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Table</span>(name <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;post&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>interface</span> <span style=color:#a6e22e>Post</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Id</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@GeneratedValue</span>(generatorType <span style=color:#f92672>=</span> UUIDIdGenerator.<span style=color:#a6e22e>class</span>)
</span></span><span style=display:flex><span>    UUID <span style=color:#a6e22e>id</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    UUID <span style=color:#a6e22e>userId</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    UUID <span style=color:#a6e22e>categoryId</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@ManyToOne</span><span style=color:#75715e>//这个注解用于标记这个属性是多对一的关系</span>
</span></span><span style=display:flex><span>    Category <span style=color:#a6e22e>category</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@NotNull</span>
</span></span><span style=display:flex><span>    String <span style=color:#a6e22e>title</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@NotNull</span>
</span></span><span style=display:flex><span>    String <span style=color:#a6e22e>content</span>();
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@Entity</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Table</span>(name <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;category&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>interface</span> <span style=color:#a6e22e>Category</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Id</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@GeneratedValue</span>(generatorType <span style=color:#f92672>=</span> UUIDIdGenerator.<span style=color:#a6e22e>class</span>)
</span></span><span style=display:flex><span>    UUID <span style=color:#a6e22e>id</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@NotNull</span>
</span></span><span style=display:flex><span>    String <span style=color:#a6e22e>name</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@OneToMany</span>(mappedBy <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;category&#34;</span>)<span style=color:#75715e>//这个注解用于标记这个属性是一对多的关系,这里的mappedBy表示这个属性在另一个实体类中的名称</span>
</span></span><span style=display:flex><span>    List<span style=color:#f92672>&lt;</span>Post<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>posts</span>();
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>之后我们开始写<code>PostController</code>的代码,在编写之前响一下,都需要写哪些方法,这里我列出来</p><ul><li>查询所有文章(包含分类),用于渲染首页,但这里不需要文章的内容,所以不需要查询文章的内容,这里需要使用<code>Fetcher</code>功能</li><li>根据文章 ID 查询文章,用于渲染文章详情页,这里需要查询文章的内容,所以需要使用<code>Fetcher</code>功能</li><li>根据分类 ID 查询文章,用于渲染分类页,但这里不需要文章的内容,这里需要使用<code>Fetcher</code>功能</li></ul><p>以上就是基本需要的方法,所以这里我们需要定义 2 个<code>Fetcher</code>,一个是不包含文章内容的<code>Fetcher</code>,一个是包含文章内容的<code>Fetcher</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>PostController</span> {
</span></span><span style=display:flex><span>    <span style=color:#75715e>//这个Fetcher用于查询所有文章,但不包含文章内容</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>final</span> PostFetcher DEFAULT_POST <span style=color:#f92672>=</span> PostFetcher.<span style=color:#a6e22e>$</span>
</span></span><span style=display:flex><span>            .<span style=color:#a6e22e>allScalarFields</span>()<span style=color:#75715e>//这个方法用于查询所有的标量字段,标量字段就是不是关联表的字段</span>
</span></span><span style=display:flex><span>            .<span style=color:#a6e22e>content</span>(<span style=color:#66d9ef>false</span>)<span style=color:#75715e>//这个方法用于设置是否查询文章内容,这里设置为false,表示不查询文章内容</span>
</span></span><span style=display:flex><span>            .<span style=color:#a6e22e>category</span>(<span style=color:#75715e>//这个方法用于设置查询文章的分类,这里使用的是一个CategoryFetcher,这个Fetcher用于查询分类</span>
</span></span><span style=display:flex><span>                    CategoryFetcher.<span style=color:#a6e22e>$</span>
</span></span><span style=display:flex><span>                            .<span style=color:#a6e22e>allScalarFields</span>()<span style=color:#75715e>//这个方法用于查询所有的标量字段,标量字段就是不是关联表的字段</span>
</span></span><span style=display:flex><span>            );
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>//这个Fetcher用于查询所有文章,包含文章内容</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>final</span> PostFetcher FULL_POST <span style=color:#f92672>=</span> PostFetcher.<span style=color:#a6e22e>$</span>
</span></span><span style=display:flex><span>            .<span style=color:#a6e22e>allScalarFields</span>()<span style=color:#75715e>//这个方法用于查询所有的标量字段,标量字段就是不是关联表的字段</span>
</span></span><span style=display:flex><span>            .<span style=color:#a6e22e>category</span>(<span style=color:#75715e>//这个方法用于设置查询文章的分类,这里使用的是一个CategoryFetcher,这个Fetcher用于查询分类</span>
</span></span><span style=display:flex><span>                    CategoryFetcher.<span style=color:#a6e22e>$</span>
</span></span><span style=display:flex><span>                            .<span style=color:#a6e22e>allScalarFields</span>()<span style=color:#75715e>//这个方法用于查询所有的标量字段,标量字段就是不是关联表的字段</span>
</span></span><span style=display:flex><span>            );
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>接着写接口</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@RestController</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@AllArgsConstructor</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>PostController</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>final</span> PostRepository repository;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>//这个方法用于创建文章</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@PutMapping</span>(<span style=color:#e6db74>&#34;/posts/&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@ResponseStatus</span>(HttpStatus.<span style=color:#a6e22e>OK</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>createPost</span>(<span style=color:#a6e22e>@RequestBody</span> PostInput postInput) {
</span></span><span style=display:flex><span>        repository.<span style=color:#a6e22e>insert</span>(PostDraft.<span style=color:#a6e22e>$</span>.<span style=color:#a6e22e>produce</span>(draft <span style=color:#f92672>-&gt;</span> {
</span></span><span style=display:flex><span>            draft.<span style=color:#a6e22e>setUserId</span>(UUID.<span style=color:#a6e22e>fromString</span>(StpUtil.<span style=color:#a6e22e>getLoginIdAsString</span>()));
</span></span><span style=display:flex><span>            draft.<span style=color:#a6e22e>setTitle</span>(postInput.<span style=color:#a6e22e>getTitle</span>());
</span></span><span style=display:flex><span>            draft.<span style=color:#a6e22e>setContent</span>(postInput.<span style=color:#a6e22e>getContent</span>());
</span></span><span style=display:flex><span>            draft.<span style=color:#a6e22e>setCategoryId</span>(postInput.<span style=color:#a6e22e>getCategoryId</span>());
</span></span><span style=display:flex><span>        }));
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>//这个方法用于查询所有文章,但不包含文章内容,FetchBy注解用于标记这个方法使用的是哪个Fetcher,其实就是为了生成Typescript代码时使用的,这个注解是Jimmer提供的,这个注解的参数是一个字符串,这个字符串就是Fetcher的名称,这个名称就是在哪个类中定义的,这里是在PostController中定义的,默认是在当前类中定义的,如果不想在当前类中定义,那么就需要使用ownerType参数来指定</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@GetMapping</span>(<span style=color:#e6db74>&#34;/posts/&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> Page<span style=color:#f92672>&lt;</span><span style=color:#a6e22e>@FetchBy</span>(value <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;FULL_POST&#34;</span>, ownerType <span style=color:#f92672>=</span> PostController.<span style=color:#a6e22e>class</span>) Post<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>findPosts</span>(<span style=color:#a6e22e>@RequestParam</span>(defaultValue <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;0&#34;</span>) Integer page, <span style=color:#a6e22e>@RequestParam</span>(defaultValue <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;10&#34;</span>) Integer size) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> repository.<span style=color:#a6e22e>findAll</span>(PageRequest.<span style=color:#a6e22e>of</span>(page, size), DEFAULT_POST);<span style=color:#75715e>//这里使用的是findAll方法,这个方法用于查询所有的实体类,这个方法的第二个参数是一个Fetcher,这个Fetcher用于查询关联表的数据,这里使用的是DEFAULT_POST,表示查询文章的分类,但不查询文章的内容,这个方法是Jimmer提供的</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>//这个方法用于查询所有文章,包含文章内容</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@GetMapping</span>(<span style=color:#e6db74>&#34;/posts/{id}&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>@FetchBy</span>(<span style=color:#e6db74>&#34;FULL_POST&#34;</span>) Post <span style=color:#a6e22e>findPost</span>(<span style=color:#a6e22e>@PathVariable</span> UUID id) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> repository.<span style=color:#a6e22e>findNullable</span>(id, FULL_POST);<span style=color:#75715e>//这里使用的是findNullable方法,这个方法用于查询一个实体类,如果查询不到,那么就返回null,如果查询到了,那么就返回这个实体类,这个方法的第二个参数是一个Fetcher,这个Fetcher用于查询关联表的数据,这里使用的是FULL_POST,表示查询文章的分类,同时查询文章的内容,这个方法是Jimmer提供的</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>//这个方法用于查询分类下的所有文章,但不包含文章内容</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@GetMapping</span>(<span style=color:#e6db74>&#34;/categories/{categoryId}/posts/&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> Page<span style=color:#f92672>&lt;</span><span style=color:#a6e22e>@FetchBy</span>(<span style=color:#e6db74>&#34;DEFAULT_POST&#34;</span>) Post<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>findPostsByCategory</span>(<span style=color:#a6e22e>@PathVariable</span> UUID categoryId, <span style=color:#a6e22e>@RequestParam</span>(defaultValue <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;0&#34;</span>) Integer page, <span style=color:#a6e22e>@RequestParam</span>(defaultValue <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;10&#34;</span>) Integer size) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> repository.<span style=color:#a6e22e>findAllByCategoryId</span>(PageRequest.<span style=color:#a6e22e>of</span>(page, size), categoryId, DEFAULT_POST);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>接着看下<code>PostRepository</code>中的代码</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@Repository</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>interface</span> <span style=color:#a6e22e>PostRepository</span> <span style=color:#66d9ef>extends</span> JRepository<span style=color:#f92672>&lt;</span>Post, UUID<span style=color:#f92672>&gt;</span> {
</span></span><span style=display:flex><span>    <span style=color:#75715e>//这个方法根据分类ID查询文章,具体的Fetcher在方法的参数中指定</span>
</span></span><span style=display:flex><span>    Page<span style=color:#f92672>&lt;</span>Post<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>findAllByCategoryId</span>(Pageable pageable, UUID categoryId, Fetcher<span style=color:#f92672>&lt;</span>Post<span style=color:#f92672>&gt;</span> fetcher);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h4 id=replycontroller>ReplyController</h4><p>然后我们需要编写<code>ReplyController</code>,这个类用于处理评论的查询,这里会使用<code>Jimmer</code>的<code>Fetcher</code>功能,这个功能用于查询关联表的数据,这里我们需要查询评论的用户,所以需要使用<code>Fetcher</code>功能</p><p>首先定义<code>ReplyInput</code>类,这个类用于接收<code>JSON</code>数据</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@Data</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>ReplyInput</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Nullable</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>final</span> UUID id;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Nullable</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>final</span> UUID userId;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Nullable</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>final</span> UUID postId;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Nullable</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>final</span> String content;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>接着设置表的关联关系,表的关联在表的实体类中进行设置</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@Entity</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Table</span>(name <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;reply&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>interface</span> <span style=color:#a6e22e>Reply</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Id</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@GeneratedValue</span>(generatorType <span style=color:#f92672>=</span> UUIDIdGenerator.<span style=color:#a6e22e>class</span>)
</span></span><span style=display:flex><span>    UUID <span style=color:#a6e22e>id</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    UUID <span style=color:#a6e22e>userId</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@ManyToOne</span><span style=color:#75715e>//这个注解用于标记这个属性是多对一的关系</span>
</span></span><span style=display:flex><span>    User <span style=color:#a6e22e>user</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    UUID <span style=color:#a6e22e>postId</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@NotNull</span>
</span></span><span style=display:flex><span>    String <span style=color:#a6e22e>content</span>();
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@Entity</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Table</span>(name <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;user&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>interface</span> <span style=color:#a6e22e>User</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Id</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@GeneratedValue</span>(generatorType <span style=color:#f92672>=</span> UUIDIdGenerator.<span style=color:#a6e22e>class</span>)
</span></span><span style=display:flex><span>    UUID <span style=color:#a6e22e>id</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@NotNull</span>
</span></span><span style=display:flex><span>    String <span style=color:#a6e22e>username</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@NotNull</span>
</span></span><span style=display:flex><span>    String <span style=color:#a6e22e>password</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@OneToMany</span>(mappedBy <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;user&#34;</span>)<span style=color:#75715e>//这个注解用于标记这个属性是一对多的关系,这里的mappedBy表示这个属性在另一个实体类中的名称</span>
</span></span><span style=display:flex><span>    List<span style=color:#f92672>&lt;</span>Reply<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>replies</span>();
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>接着写接口</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@RestController</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@AllArgsConstructor</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>ReplyController</span> {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>final</span> ReplyRepository replyRepository;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@PutMapping</span>(<span style=color:#e6db74>&#34;/replies/&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>createReply</span>(<span style=color:#a6e22e>@RequestBody</span> ReplyInput replyInput) {
</span></span><span style=display:flex><span>        replyRepository.<span style=color:#a6e22e>insert</span>(ReplyDraft.<span style=color:#a6e22e>$</span>.<span style=color:#a6e22e>produce</span>(draft <span style=color:#f92672>-&gt;</span> {
</span></span><span style=display:flex><span>            draft.<span style=color:#a6e22e>setUserId</span>(UUID.<span style=color:#a6e22e>fromString</span>(StpUtil.<span style=color:#a6e22e>getLoginIdAsString</span>()));
</span></span><span style=display:flex><span>            draft.<span style=color:#a6e22e>setContent</span>(replyInput.<span style=color:#a6e22e>getContent</span>());
</span></span><span style=display:flex><span>            draft.<span style=color:#a6e22e>setPostId</span>(replyInput.<span style=color:#a6e22e>getPostId</span>());
</span></span><span style=display:flex><span>        }));
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@GetMapping</span>(<span style=color:#e6db74>&#34;/posts/{postId}/replies/&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> Page<span style=color:#f92672>&lt;</span><span style=color:#a6e22e>@FetchBy</span>(<span style=color:#e6db74>&#34;DEFAULT_REPLY&#34;</span>) Reply<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>findRepliesByPost</span>(<span style=color:#a6e22e>@PathVariable</span> UUID postId, <span style=color:#a6e22e>@RequestParam</span>(defaultValue <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;0&#34;</span>) Integer page, <span style=color:#a6e22e>@RequestParam</span>(defaultValue <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;10&#34;</span>) Integer size) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> replyRepository.<span style=color:#a6e22e>findAllByPostId</span>(PageRequest.<span style=color:#a6e22e>of</span>(page, size), postId, DEFAULT_REPLY);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>//这个方法用于查询所有评论,包含评论的用户,但不包含用户的密码</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>final</span> ReplyFetcher DEFAULT_REPLY <span style=color:#f92672>=</span> ReplyFetcher.<span style=color:#a6e22e>$</span>.<span style=color:#a6e22e>allScalarFields</span>().<span style=color:#a6e22e>user</span>(UserFetcher.<span style=color:#a6e22e>$</span>.<span style=color:#a6e22e>username</span>());
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h4 id=exceptioncontroller>ExceptionController</h4><p>现在编写全局异常处理,这个异常处理用于处理<code>NullPointerException</code>和<code>IllegalArgumentException</code>等异常</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@ControllerAdvice</span><span style=color:#75715e>//这个注解用于标记这个类是一个全局异常处理类</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>ExceptionController</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@ExceptionHandler</span>(Exception.<span style=color:#a6e22e>class</span>)<span style=color:#75715e>//这个注解用于标记这个方法是一个异常处理方法,这里的参数是异常的类型,因为要处理所有的异常,所以这里使用的是Exception</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> ResponseEntity<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>exception</span>(Exception exception) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (exception <span style=color:#66d9ef>instanceof</span> NullPointerException) {
</span></span><span style=display:flex><span>            <span style=color:#75715e>//这里返回的是一个ResponseEntity,这个对象包含了状态码和响应体,这里我们返回的是404状态码和异常信息</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> ResponseEntity.<span style=color:#a6e22e>status</span>(HttpStatus.<span style=color:#a6e22e>NOT_FOUND</span>).<span style=color:#a6e22e>body</span>(exception.<span style=color:#a6e22e>getMessage</span>());
</span></span><span style=display:flex><span>        } <span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span> (exception <span style=color:#66d9ef>instanceof</span> IllegalArgumentException) {
</span></span><span style=display:flex><span>            <span style=color:#75715e>//这里返回的是一个ResponseEntity,这个对象包含了状态码和响应体,这里我们返回的是400状态码和异常信息</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> ResponseEntity.<span style=color:#a6e22e>status</span>(HttpStatus.<span style=color:#a6e22e>BAD_REQUEST</span>).<span style=color:#a6e22e>body</span>(exception.<span style=color:#a6e22e>getMessage</span>());
</span></span><span style=display:flex><span>        } <span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span> (exception <span style=color:#66d9ef>instanceof</span> NotLoginException) {
</span></span><span style=display:flex><span>            <span style=color:#75715e>//这里返回的是一个ResponseEntity,这个对象包含了状态码和响应体,这里我们返回的是401状态码和异常信息</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> ResponseEntity.<span style=color:#a6e22e>status</span>(HttpStatus.<span style=color:#a6e22e>UNAUTHORIZED</span>).<span style=color:#a6e22e>body</span>(exception.<span style=color:#a6e22e>getMessage</span>());
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#75715e>//这里返回的是一个ResponseEntity,这个对象包含了状态码和响应体,这里我们返回的是500状态码和异常信息</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> ResponseEntity.<span style=color:#a6e22e>status</span>(HttpStatus.<span style=color:#a6e22e>INTERNAL_SERVER_ERROR</span>).<span style=color:#a6e22e>body</span>(exception.<span style=color:#a6e22e>getMessage</span>());
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>最后我们要开启后端的<code>CORS</code>,这个功能用于解决跨域问题,这里我使用的是拦截器来实现的,首先我们需要编写一个<code>CorsInterceptor</code>类,这个类用于拦截所有的请求,然后设置响应头</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@Component</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>CorsInterceptor</span> <span style=color:#66d9ef>implements</span> HandlerInterceptor {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>boolean</span> <span style=color:#a6e22e>preHandle</span>(<span style=color:#a6e22e>@NotNull</span> HttpServletRequest request, <span style=color:#a6e22e>@NotNull</span> HttpServletResponse response, <span style=color:#a6e22e>@NotNull</span> Object handler) <span style=color:#66d9ef>throws</span> Exception {
</span></span><span style=display:flex><span>        response.<span style=color:#a6e22e>setHeader</span>(HttpHeaders.<span style=color:#a6e22e>ACCESS_CONTROL_ALLOW_METHODS</span>, <span style=color:#e6db74>&#34;*&#34;</span>);
</span></span><span style=display:flex><span>        response.<span style=color:#a6e22e>setHeader</span>(HttpHeaders.<span style=color:#a6e22e>ACCESS_CONTROL_ALLOW_HEADERS</span>, <span style=color:#e6db74>&#34;*&#34;</span>);
</span></span><span style=display:flex><span>        response.<span style=color:#a6e22e>setHeader</span>(HttpHeaders.<span style=color:#a6e22e>ACCESS_CONTROL_ALLOW_ORIGIN</span>, <span style=color:#e6db74>&#34;*&#34;</span>);
</span></span><span style=display:flex><span>        response.<span style=color:#a6e22e>setHeader</span>(HttpHeaders.<span style=color:#a6e22e>ACCESS_CONTROL_ALLOW_CREDENTIALS</span>, <span style=color:#e6db74>&#34;true&#34;</span>);
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> HandlerInterceptor.<span style=color:#a6e22e>super</span>.<span style=color:#a6e22e>preHandle</span>(request, response, handler);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>然后我们需要在<code>WebMvcConfigurer</code>中注册这个拦截器</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@Configuration</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@AllArgsConstructor</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>WebMvcConfiguration</span> <span style=color:#66d9ef>implements</span> WebMvcConfigurer {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>final</span> CorsInterceptor corsInterceptor;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>addInterceptors</span>(InterceptorRegistry registry) {
</span></span><span style=display:flex><span>        registry.<span style=color:#a6e22e>addInterceptor</span>(corsInterceptor);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=前端编写>前端编写</h2><h3 id=生成前端的代码>生成前端的代码</h3><p>我们在后端定义了那么多的实体类,那么我们需要将这些实体类生成<code>TypeScript</code>的代码,这里我们使用的是<code>Jimmer</code>自带的功能,在之前的配置中我们配置了<code>jimmer.client.ts.path=/typescript.zip</code>,这个配置用于指定生成的<code>TypeScript</code>代码的路径,我们可以手动访问这个地址下载一个压缩包,然后解压这个压缩包,然后将其中的<code>typescript</code>文件夹复制到<code>src</code>目录下,也可以写一个脚本来自动完成这些工作,这里我使用了<code>PowerShell</code>来完成这些工作,在和<code>src</code>的同级目录下新建一个<code>scripts</code>目录,然后在其中新建一个<code>generated.ps1</code>文件,这个文件用于生成<code>TypeScript</code>代码</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span>$sourceUrl = <span style=color:#e6db74>&#34;http://localhost:8080/typescript.zip&#34;</span>
</span></span><span style=display:flex><span>$tempDir = Join-Path $(Get-Item -Path $env:TEMP).FullName (New-Guid).ToString()
</span></span><span style=display:flex><span>$generatedPath = Join-Path (Split-Path $PSScriptRoot) <span style=color:#e6db74>&#34;src/__generated&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 下载源码并解压</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> (<span style=color:#f92672>-not</span> (Test-Path $tempDir)) {
</span></span><span style=display:flex><span>    New-Item -ItemType Directory -Path $tempDir | Out-Null
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Write-Host <span style=color:#e6db74>&#34;Downloading </span>$sourceUrl<span style=color:#e6db74> to </span>$tempDir<span style=color:#e6db74>...&#34;</span>
</span></span><span style=display:flex><span>Invoke-WebRequest -Uri $sourceUrl -OutFile <span style=color:#e6db74>&#34;</span>$tempDir<span style=color:#e6db74>/source.zip&#34;</span>
</span></span><span style=display:flex><span>Write-Host <span style=color:#e6db74>&#34;Extracting files from </span>$tempDir<span style=color:#e6db74>/source.zip...&#34;</span>
</span></span><span style=display:flex><span>Expand-Archive -Path <span style=color:#e6db74>&#34;</span>$tempDir<span style=color:#e6db74>/source.zip&#34;</span> -DestinationPath $tempDir
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 删除已有的生成路径</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> (Test-Path $generatedPath) {
</span></span><span style=display:flex><span>    Write-Host <span style=color:#e6db74>&#34;Deleting existing generated path </span>$generatedPath<span style=color:#e6db74>...&#34;</span>
</span></span><span style=display:flex><span>    Remove-Item -Path $generatedPath -Recurse -Force
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 移动文件</span>
</span></span><span style=display:flex><span>Write-Host <span style=color:#e6db74>&#34;Moving files from </span>$tempDir<span style=color:#e6db74> to </span>$generatedPath<span style=color:#e6db74>...&#34;</span>
</span></span><span style=display:flex><span>Move-Item -Path $tempDir -Destination $generatedPath
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 删除源码</span>
</span></span><span style=display:flex><span>Remove-Item -Path <span style=color:#e6db74>&#34;</span>$generatedPath<span style=color:#e6db74>/source.zip&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Write-Host <span style=color:#e6db74>&#34;API code is refreshed successfully.&#34;</span>
</span></span></code></pre></div><p>如果是对<code>Typescript</code>代码比较熟悉的话,看这些生成的代码应该没什么问题,但这里时间有限,所以我就不详细讲解了</p><h3 id=编写前端代码>编写前端代码</h3><p>在生成了代码之后,我们还需要为<code>fetch</code>创建一个拦截器,这个拦截器用于在每次请求时添加<code>token</code>,在<code>common</code>目录中新建一个<code>ApiInstance.ts</code>文件,这个文件用于创建<code>fetch</code>的实例</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ts data-lang=ts><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>Api</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#34;../__generated&#34;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>useSessionStore</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#34;../store&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>//创建一个Api实例
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>api</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Api</span>(<span style=color:#66d9ef>async</span> ({ <span style=color:#a6e22e>uri</span>, <span style=color:#a6e22e>method</span>, <span style=color:#a6e22e>body</span> }) <span style=color:#f92672>=&gt;</span> {
</span></span><span style=display:flex><span>  <span style=color:#75715e>//获取token
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>token</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>useSessionStore</span>().<span style=color:#a6e22e>token</span> <span style=color:#66d9ef>as</span> <span style=color:#66d9ef>string</span> <span style=color:#f92672>|</span> <span style=color:#66d9ef>undefined</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>//发送请求
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>response</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>fetch</span>(<span style=color:#e6db74>`http://localhost:8080</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>uri</span><span style=color:#e6db74>}</span><span style=color:#e6db74>`</span>, {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>method</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>body</span>: <span style=color:#66d9ef>body</span> <span style=color:#f92672>!==</span> <span style=color:#66d9ef>undefined</span> <span style=color:#f92672>?</span> <span style=color:#a6e22e>JSON</span>.<span style=color:#a6e22e>stringify</span>(<span style=color:#a6e22e>body</span>) <span style=color:#f92672>:</span> <span style=color:#66d9ef>undefined</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>headers</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#34;content-type&#34;</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;application/json;charset=UTF-8&#34;</span>,
</span></span><span style=display:flex><span>      ...(<span style=color:#a6e22e>token</span> <span style=color:#f92672>!==</span> <span style=color:#66d9ef>undefined</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>token</span> <span style=color:#f92672>!==</span> <span style=color:#e6db74>&#34;&#34;</span> <span style=color:#f92672>?</span> { <span style=color:#a6e22e>token</span> } <span style=color:#f92672>:</span> {})
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  })
</span></span><span style=display:flex><span>  <span style=color:#75715e>//如果响应状态码不是200,那么就抛出一个错误
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>response</span>.<span style=color:#a6e22e>status</span> <span style=color:#f92672>!==</span> <span style=color:#ae81ff>200</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>response</span>.<span style=color:#a6e22e>text</span>()
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#75715e>//获取响应体
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>text</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>response</span>.<span style=color:#a6e22e>text</span>()
</span></span><span style=display:flex><span>  <span style=color:#75715e>//如果响应体为空,那么就返回null
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>text</span>.<span style=color:#a6e22e>length</span> <span style=color:#f92672>===</span> <span style=color:#ae81ff>0</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>null</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#75715e>//返回响应体
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>JSON</span>.<span style=color:#a6e22e>parse</span>(<span style=color:#a6e22e>text</span>)
</span></span><span style=display:flex><span>})
</span></span></code></pre></div><h3 id=编写注册页面>编写注册页面</h3><p>在<code>views</code>目录下新建一个<code>Register.tsx</code>文件,这个文件用于渲染注册页面</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-tsx data-lang=tsx><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>createImmerSignal</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#34;solid-immer&#34;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>UserInput</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#34;../__generated/model/static&#34;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>api</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#34;../common/ApiInstance&#34;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> <span style=color:#a6e22e>toast</span> <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#34;solid-toast&#34;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>Link</span>, <span style=color:#a6e22e>Route</span>, <span style=color:#a6e22e>useNavigate</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#34;@solidjs/router&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>Register</span> <span style=color:#f92672>=</span> () <span style=color:#f92672>=&gt;</span> {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>navigate</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>useNavigate</span>() <span style=color:#75715e>//这个函数用于跳转路由
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>formRef</span> <span style=color:#75715e>//这个引用用于获取表单元素
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> [<span style=color:#a6e22e>form</span>, <span style=color:#a6e22e>setForm</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>createImmerSignal</span>&lt;<span style=color:#f92672>UserInput</span>&gt;({}) <span style=color:#75715e>//这个函数用于创建一个信号,这个信号用于存储表单数据
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>submit</span> <span style=color:#f92672>=</span> (<span style=color:#a6e22e>e</span>) <span style=color:#f92672>=&gt;</span> {
</span></span><span style=display:flex><span>    <span style=color:#75715e>//阻止默认事件
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>e</span>.<span style=color:#a6e22e>preventDefault</span>()
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>e</span>.<span style=color:#a6e22e>stopPropagation</span>()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>//如果表单验证通过,那么就发送请求
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>formRef</span>.<span style=color:#a6e22e>checkValidity</span>()) {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>api</span>.<span style=color:#a6e22e>userController</span>
</span></span><span style=display:flex><span>        .<span style=color:#a6e22e>register</span>({ <span style=color:#a6e22e>body</span>: <span style=color:#66d9ef>form</span>() })
</span></span><span style=display:flex><span>        .<span style=color:#a6e22e>then</span>(() <span style=color:#f92672>=&gt;</span> {
</span></span><span style=display:flex><span>          <span style=color:#75715e>//如果注册成功,那么就跳转到登录页面
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>          <span style=color:#a6e22e>toast</span>.<span style=color:#a6e22e>success</span>(<span style=color:#e6db74>&#34;Registered successfully&#34;</span>)
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>navigate</span>(<span style=color:#e6db74>&#34;/login&#34;</span>)
</span></span><span style=display:flex><span>        })
</span></span><span style=display:flex><span>        .<span style=color:#66d9ef>catch</span>((<span style=color:#a6e22e>err</span>) <span style=color:#f92672>=&gt;</span> {
</span></span><span style=display:flex><span>          <span style=color:#75715e>//如果注册失败,那么就显示错误信息
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>          <span style=color:#a6e22e>toast</span>.<span style=color:#a6e22e>error</span>(<span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>        })
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>//这里需要手动调用表单的验证方法,因为我们使用的是原生的表单验证,而不是使用第三方库
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>formRef</span>.<span style=color:#a6e22e>classList</span>.<span style=color:#a6e22e>add</span>(<span style=color:#e6db74>&#34;was-validated&#34;</span>)
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> (
</span></span><span style=display:flex><span>    &lt;<span style=color:#f92672>div</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;vh-100 d-flex justify-content-center align-items-center&#34;</span>&gt;
</span></span><span style=display:flex><span>      &lt;<span style=color:#f92672>div</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;card p-5&#34;</span>&gt;
</span></span><span style=display:flex><span>        &lt;<span style=color:#f92672>form</span> <span style=color:#a6e22e>ref</span><span style=color:#f92672>=</span>{<span style=color:#a6e22e>formRef</span>} <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;needs-validation&#34;</span> <span style=color:#a6e22e>style</span><span style=color:#f92672>=</span>{{ <span style=color:#a6e22e>width</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;18rem&#34;</span>, <span style=color:#a6e22e>height</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;14rem&#34;</span> }} <span style=color:#a6e22e>novalidate</span>&gt;
</span></span><span style=display:flex><span>          &lt;<span style=color:#f92672>div</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;d-flex flex-column justify-content-between h-100&#34;</span>&gt;
</span></span><span style=display:flex><span>            &lt;<span style=color:#f92672>div</span>&gt;
</span></span><span style=display:flex><span>              &lt;<span style=color:#f92672>label</span> <span style=color:#a6e22e>for</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;validationCustom01&#34;</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;form-label&#34;</span>&gt;
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>Username</span>
</span></span><span style=display:flex><span>              &lt;/<span style=color:#f92672>label</span>&gt;
</span></span><span style=display:flex><span>              &lt;<span style=color:#f92672>input</span>
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>type</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;text&#34;</span>
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;form-control&#34;</span>
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>id</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;validationCustom01&#34;</span>
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>value</span><span style=color:#f92672>=</span>{<span style=color:#a6e22e>form</span>().<span style=color:#a6e22e>username</span> <span style=color:#f92672>??</span> <span style=color:#e6db74>&#34;&#34;</span>}
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>required</span>
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>onInput</span><span style=color:#f92672>=</span>{(<span style=color:#a6e22e>e</span>) <span style=color:#f92672>=&gt;</span> <span style=color:#a6e22e>setForm</span>((<span style=color:#a6e22e>draft</span>) <span style=color:#f92672>=&gt;</span> (<span style=color:#a6e22e>draft</span>.<span style=color:#a6e22e>username</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>e</span>.<span style=color:#a6e22e>currentTarget</span>.<span style=color:#a6e22e>value</span>))}
</span></span><span style=display:flex><span>              /&gt;
</span></span><span style=display:flex><span>              &lt;<span style=color:#f92672>div</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;valid-feedback&#34;</span>&gt;<span style=color:#a6e22e>Looks</span> <span style=color:#a6e22e>good</span><span style=color:#f92672>!</span>&lt;/<span style=color:#f92672>div</span>&gt;
</span></span><span style=display:flex><span>              &lt;<span style=color:#f92672>div</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;invalid-feedback&#34;</span>&gt;<span style=color:#a6e22e>Please</span> <span style=color:#a6e22e>enter</span> <span style=color:#a6e22e>your</span> <span style=color:#a6e22e>username</span>.&lt;/<span style=color:#f92672>div</span>&gt;
</span></span><span style=display:flex><span>            &lt;/<span style=color:#f92672>div</span>&gt;
</span></span><span style=display:flex><span>            &lt;<span style=color:#f92672>div</span>&gt;
</span></span><span style=display:flex><span>              &lt;<span style=color:#f92672>label</span> <span style=color:#a6e22e>for</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;validationCustom02&#34;</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;form-label&#34;</span>&gt;
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>Password</span>
</span></span><span style=display:flex><span>              &lt;/<span style=color:#f92672>label</span>&gt;
</span></span><span style=display:flex><span>              &lt;<span style=color:#f92672>input</span>
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>type</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;text&#34;</span>
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;form-control&#34;</span>
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>id</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;validationCustom02&#34;</span>
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>required</span>
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>value</span><span style=color:#f92672>=</span>{<span style=color:#a6e22e>form</span>().<span style=color:#a6e22e>password</span> <span style=color:#f92672>??</span> <span style=color:#e6db74>&#34;&#34;</span>}
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>onInput</span><span style=color:#f92672>=</span>{(<span style=color:#a6e22e>e</span>) <span style=color:#f92672>=&gt;</span> <span style=color:#a6e22e>setForm</span>((<span style=color:#a6e22e>draft</span>) <span style=color:#f92672>=&gt;</span> (<span style=color:#a6e22e>draft</span>.<span style=color:#a6e22e>password</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>e</span>.<span style=color:#a6e22e>currentTarget</span>.<span style=color:#a6e22e>value</span>))}
</span></span><span style=display:flex><span>              /&gt;
</span></span><span style=display:flex><span>              &lt;<span style=color:#f92672>div</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;valid-feedback&#34;</span>&gt;<span style=color:#a6e22e>Looks</span> <span style=color:#a6e22e>good</span><span style=color:#f92672>!</span>&lt;/<span style=color:#f92672>div</span>&gt;
</span></span><span style=display:flex><span>              &lt;<span style=color:#f92672>div</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;invalid-feedback&#34;</span>&gt;<span style=color:#a6e22e>Please</span> <span style=color:#a6e22e>enter</span> <span style=color:#a6e22e>your</span> <span style=color:#a6e22e>password</span>.&lt;/<span style=color:#f92672>div</span>&gt;
</span></span><span style=display:flex><span>            &lt;/<span style=color:#f92672>div</span>&gt;
</span></span><span style=display:flex><span>            &lt;<span style=color:#f92672>Link</span> <span style=color:#a6e22e>href</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;/login&#34;</span>&gt;<span style=color:#a6e22e>Login</span>&lt;/<span style=color:#f92672>Link</span>&gt;
</span></span><span style=display:flex><span>            {<span style=color:#75715e>/* 这里使用了Link组件,这个组件用于跳转路由 */</span>}
</span></span><span style=display:flex><span>            &lt;<span style=color:#f92672>button</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;btn btn-primary&#34;</span> <span style=color:#a6e22e>type</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;submit&#34;</span> <span style=color:#a6e22e>onClick</span><span style=color:#f92672>=</span>{<span style=color:#a6e22e>submit</span>}&gt;
</span></span><span style=display:flex><span>              <span style=color:#a6e22e>Register</span>
</span></span><span style=display:flex><span>            &lt;/<span style=color:#f92672>button</span>&gt;
</span></span><span style=display:flex><span>          &lt;/<span style=color:#f92672>div</span>&gt;
</span></span><span style=display:flex><span>        &lt;/<span style=color:#f92672>form</span>&gt;
</span></span><span style=display:flex><span>      &lt;/<span style=color:#f92672>div</span>&gt;
</span></span><span style=display:flex><span>    &lt;/<span style=color:#f92672>div</span>&gt;
</span></span><span style=display:flex><span>  )
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>default</span> <span style=color:#a6e22e>Register</span>
</span></span></code></pre></div><h3 id=编写登录页面>编写登录页面</h3><p>在之前已经创建好的<code>Login.tsx</code>中编写登录页面</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-tsx data-lang=tsx><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>createImmerSignal</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#34;solid-immer&#34;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>useSessionStore</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#34;../store&#34;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>UserInput</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#34;../__generated/model/static&#34;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>api</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#34;../common/ApiInstance&#34;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> <span style=color:#a6e22e>toast</span> <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#34;solid-toast&#34;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>Link</span>, <span style=color:#a6e22e>Route</span>, <span style=color:#a6e22e>useNavigate</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#34;@solidjs/router&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>Login</span> <span style=color:#f92672>=</span> () <span style=color:#f92672>=&gt;</span> {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>navigate</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>useNavigate</span>()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>session</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>useSessionStore</span>() <span style=color:#75715e>//这个函数用于获取session状态
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>formRef</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> [<span style=color:#a6e22e>form</span>, <span style=color:#a6e22e>setForm</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>createImmerSignal</span>&lt;<span style=color:#f92672>UserInput</span>&gt;({})
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>submit</span> <span style=color:#f92672>=</span> (<span style=color:#a6e22e>e</span>) <span style=color:#f92672>=&gt;</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>e</span>.<span style=color:#a6e22e>preventDefault</span>()
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>e</span>.<span style=color:#a6e22e>stopPropagation</span>()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>formRef</span>.<span style=color:#a6e22e>checkValidity</span>()) {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>api</span>.<span style=color:#a6e22e>sessionController</span>
</span></span><span style=display:flex><span>        .<span style=color:#a6e22e>login</span>({ <span style=color:#a6e22e>body</span>: <span style=color:#66d9ef>form</span>() })
</span></span><span style=display:flex><span>        .<span style=color:#a6e22e>then</span>((<span style=color:#a6e22e>data</span>) <span style=color:#f92672>=&gt;</span> {
</span></span><span style=display:flex><span>          <span style=color:#75715e>//如果登录成功,那么就将token和id存储到session中,然后跳转到首页
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>          <span style=color:#a6e22e>session</span>.<span style=color:#a6e22e>setToken</span>(<span style=color:#a6e22e>data</span>.<span style=color:#a6e22e>token</span>)
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>session</span>.<span style=color:#a6e22e>setId</span>(<span style=color:#a6e22e>data</span>.<span style=color:#a6e22e>id</span>)
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>navigate</span>(<span style=color:#e6db74>&#34;/&#34;</span>)
</span></span><span style=display:flex><span>        })
</span></span><span style=display:flex><span>        .<span style=color:#66d9ef>catch</span>((<span style=color:#a6e22e>err</span>) <span style=color:#f92672>=&gt;</span> {
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>toast</span>.<span style=color:#a6e22e>error</span>(<span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>        })
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>formRef</span>.<span style=color:#a6e22e>classList</span>.<span style=color:#a6e22e>add</span>(<span style=color:#e6db74>&#34;was-validated&#34;</span>)
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> (
</span></span><span style=display:flex><span>    &lt;<span style=color:#f92672>div</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;vh-100 d-flex justify-content-center align-items-center&#34;</span>&gt;
</span></span><span style=display:flex><span>      &lt;<span style=color:#f92672>div</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;card p-5&#34;</span>&gt;
</span></span><span style=display:flex><span>        &lt;<span style=color:#f92672>form</span> <span style=color:#a6e22e>ref</span><span style=color:#f92672>=</span>{<span style=color:#a6e22e>formRef</span>} <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;needs-validation&#34;</span> <span style=color:#a6e22e>style</span><span style=color:#f92672>=</span>{{ <span style=color:#a6e22e>width</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;18rem&#34;</span>, <span style=color:#a6e22e>height</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;14rem&#34;</span> }} <span style=color:#a6e22e>novalidate</span>&gt;
</span></span><span style=display:flex><span>          &lt;<span style=color:#f92672>div</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;d-flex flex-column justify-content-between h-100&#34;</span>&gt;
</span></span><span style=display:flex><span>            &lt;<span style=color:#f92672>div</span>&gt;
</span></span><span style=display:flex><span>              &lt;<span style=color:#f92672>label</span> <span style=color:#a6e22e>for</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;validationCustom01&#34;</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;form-label&#34;</span>&gt;
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>Username</span>
</span></span><span style=display:flex><span>              &lt;/<span style=color:#f92672>label</span>&gt;
</span></span><span style=display:flex><span>              &lt;<span style=color:#f92672>input</span>
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>type</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;text&#34;</span>
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;form-control&#34;</span>
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>id</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;validationCustom01&#34;</span>
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>value</span><span style=color:#f92672>=</span>{<span style=color:#a6e22e>form</span>().<span style=color:#a6e22e>username</span> <span style=color:#f92672>??</span> <span style=color:#e6db74>&#34;&#34;</span>}
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>required</span>
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>onInput</span><span style=color:#f92672>=</span>{(<span style=color:#a6e22e>e</span>) <span style=color:#f92672>=&gt;</span> <span style=color:#a6e22e>setForm</span>((<span style=color:#a6e22e>draft</span>) <span style=color:#f92672>=&gt;</span> (<span style=color:#a6e22e>draft</span>.<span style=color:#a6e22e>username</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>e</span>.<span style=color:#a6e22e>currentTarget</span>.<span style=color:#a6e22e>value</span>))}
</span></span><span style=display:flex><span>              /&gt;
</span></span><span style=display:flex><span>              &lt;<span style=color:#f92672>div</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;valid-feedback&#34;</span>&gt;<span style=color:#a6e22e>Looks</span> <span style=color:#a6e22e>good</span><span style=color:#f92672>!</span>&lt;/<span style=color:#f92672>div</span>&gt;
</span></span><span style=display:flex><span>              &lt;<span style=color:#f92672>div</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;invalid-feedback&#34;</span>&gt;<span style=color:#a6e22e>Please</span> <span style=color:#a6e22e>enter</span> <span style=color:#a6e22e>your</span> <span style=color:#a6e22e>username</span>.&lt;/<span style=color:#f92672>div</span>&gt;
</span></span><span style=display:flex><span>            &lt;/<span style=color:#f92672>div</span>&gt;
</span></span><span style=display:flex><span>            &lt;<span style=color:#f92672>div</span>&gt;
</span></span><span style=display:flex><span>              &lt;<span style=color:#f92672>label</span> <span style=color:#a6e22e>for</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;validationCustom02&#34;</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;form-label&#34;</span>&gt;
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>Password</span>
</span></span><span style=display:flex><span>              &lt;/<span style=color:#f92672>label</span>&gt;
</span></span><span style=display:flex><span>              &lt;<span style=color:#f92672>input</span>
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>type</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;text&#34;</span>
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;form-control&#34;</span>
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>id</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;validationCustom02&#34;</span>
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>required</span>
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>value</span><span style=color:#f92672>=</span>{<span style=color:#a6e22e>form</span>().<span style=color:#a6e22e>password</span> <span style=color:#f92672>??</span> <span style=color:#e6db74>&#34;&#34;</span>}
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>onInput</span><span style=color:#f92672>=</span>{(<span style=color:#a6e22e>e</span>) <span style=color:#f92672>=&gt;</span> <span style=color:#a6e22e>setForm</span>((<span style=color:#a6e22e>draft</span>) <span style=color:#f92672>=&gt;</span> (<span style=color:#a6e22e>draft</span>.<span style=color:#a6e22e>password</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>e</span>.<span style=color:#a6e22e>currentTarget</span>.<span style=color:#a6e22e>value</span>))}
</span></span><span style=display:flex><span>              /&gt;
</span></span><span style=display:flex><span>              &lt;<span style=color:#f92672>div</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;valid-feedback&#34;</span>&gt;<span style=color:#a6e22e>Looks</span> <span style=color:#a6e22e>good</span><span style=color:#f92672>!</span>&lt;/<span style=color:#f92672>div</span>&gt;
</span></span><span style=display:flex><span>              &lt;<span style=color:#f92672>div</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;invalid-feedback&#34;</span>&gt;<span style=color:#a6e22e>Please</span> <span style=color:#a6e22e>enter</span> <span style=color:#a6e22e>your</span> <span style=color:#a6e22e>password</span>.&lt;/<span style=color:#f92672>div</span>&gt;
</span></span><span style=display:flex><span>            &lt;/<span style=color:#f92672>div</span>&gt;
</span></span><span style=display:flex><span>            &lt;<span style=color:#f92672>Link</span> <span style=color:#a6e22e>href</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;/register&#34;</span>&gt;<span style=color:#a6e22e>Register</span>&lt;/<span style=color:#f92672>Link</span>&gt;
</span></span><span style=display:flex><span>            &lt;<span style=color:#f92672>button</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;btn btn-primary&#34;</span> <span style=color:#a6e22e>type</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;submit&#34;</span> <span style=color:#a6e22e>onClick</span><span style=color:#f92672>=</span>{<span style=color:#a6e22e>submit</span>}&gt;
</span></span><span style=display:flex><span>              <span style=color:#a6e22e>Login</span>
</span></span><span style=display:flex><span>            &lt;/<span style=color:#f92672>button</span>&gt;
</span></span><span style=display:flex><span>          &lt;/<span style=color:#f92672>div</span>&gt;
</span></span><span style=display:flex><span>        &lt;/<span style=color:#f92672>form</span>&gt;
</span></span><span style=display:flex><span>      &lt;/<span style=color:#f92672>div</span>&gt;
</span></span><span style=display:flex><span>    &lt;/<span style=color:#f92672>div</span>&gt;
</span></span><span style=display:flex><span>  )
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>default</span> <span style=color:#a6e22e>Login</span>
</span></span></code></pre></div><h3 id=编写首页布局>编写首页布局</h3><p>在<code>src</code>目录下新建一个<code>layouts</code>目录,之后在里面创建一个<code>HomeLayout.tsx</code>文件,这就是首页的布局,这个布局包含了一个导航栏</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-tsx data-lang=tsx><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>Outlet</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#34;@solidjs/router&#34;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> <span style=color:#a6e22e>Nav</span> <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#34;../components/Nav&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>HomeLayout</span> <span style=color:#f92672>=</span> () <span style=color:#f92672>=&gt;</span> {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> (
</span></span><span style=display:flex><span>    &lt;<span style=color:#f92672>div</span>&gt;
</span></span><span style=display:flex><span>      &lt;<span style=color:#f92672>div</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;container&#34;</span>&gt;
</span></span><span style=display:flex><span>        &lt;<span style=color:#f92672>Nav</span> /&gt;
</span></span><span style=display:flex><span>      &lt;/<span style=color:#f92672>div</span>&gt;
</span></span><span style=display:flex><span>      &lt;<span style=color:#f92672>div</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;container&#34;</span>&gt;
</span></span><span style=display:flex><span>        {<span style=color:#75715e>/* 这里使用了Outlet组件,这个组件用于渲染子路由 */</span>}
</span></span><span style=display:flex><span>        &lt;<span style=color:#f92672>Outlet</span> /&gt;
</span></span><span style=display:flex><span>      &lt;/<span style=color:#f92672>div</span>&gt;
</span></span><span style=display:flex><span>    &lt;/<span style=color:#f92672>div</span>&gt;
</span></span><span style=display:flex><span>  )
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>default</span> <span style=color:#a6e22e>HomeLayout</span>
</span></span></code></pre></div><p>然后在<code>src</code>目录下新建一个<code>components</code>目录,在其中新建一个<code>Nav.tsx</code>文件,这个文件用于渲染导航栏,<code>Logo</code>可以从<code>SolidJS</code>的官网下载,然后放到<code>assets</code>目录下,直接把官网上的扒下来就行</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-tsx data-lang=tsx><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>Link</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#34;@solidjs/router&#34;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> <span style=color:#a6e22e>Logo</span> <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#34;../assets/solid.svg&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>Nav</span> <span style=color:#f92672>=</span> () <span style=color:#f92672>=&gt;</span> {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> (
</span></span><span style=display:flex><span>    &lt;<span style=color:#f92672>div</span>&gt;
</span></span><span style=display:flex><span>      &lt;<span style=color:#f92672>nav</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;navbar navbar-expand-lg navbar-light&#34;</span>&gt;
</span></span><span style=display:flex><span>        &lt;<span style=color:#f92672>img</span> <span style=color:#a6e22e>src</span><span style=color:#f92672>=</span>{<span style=color:#a6e22e>Logo</span>} <span style=color:#a6e22e>alt</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;&#34;</span> <span style=color:#a6e22e>width</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;30&#34;</span> <span style=color:#a6e22e>height</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;24&#34;</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;d-inline-block align-text-top&#34;</span> /&gt;
</span></span><span style=display:flex><span>        &lt;<span style=color:#f92672>span</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;navbar-brand mb-0 h1&#34;</span>&gt;<span style=color:#a6e22e>Solid</span>&lt;/<span style=color:#f92672>span</span>&gt;
</span></span><span style=display:flex><span>        &lt;<span style=color:#f92672>ul</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;navbar-nav me-auto mb-2 mb-lg-0&#34;</span>&gt;
</span></span><span style=display:flex><span>          &lt;<span style=color:#f92672>li</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;nav-item&#34;</span>&gt;
</span></span><span style=display:flex><span>            &lt;<span style=color:#f92672>Link</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;nav-link&#34;</span> <span style=color:#a6e22e>href</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;/&#34;</span>&gt;
</span></span><span style=display:flex><span>              <span style=color:#a6e22e>Posts</span>
</span></span><span style=display:flex><span>            &lt;/<span style=color:#f92672>Link</span>&gt;
</span></span><span style=display:flex><span>          &lt;/<span style=color:#f92672>li</span>&gt;
</span></span><span style=display:flex><span>          &lt;<span style=color:#f92672>li</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;nav-item&#34;</span>&gt;
</span></span><span style=display:flex><span>            &lt;<span style=color:#f92672>Link</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;nav-link&#34;</span> <span style=color:#a6e22e>href</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;/category&#34;</span>&gt;
</span></span><span style=display:flex><span>              <span style=color:#a6e22e>Category</span>
</span></span><span style=display:flex><span>            &lt;/<span style=color:#f92672>Link</span>&gt;
</span></span><span style=display:flex><span>          &lt;/<span style=color:#f92672>li</span>&gt;
</span></span><span style=display:flex><span>          &lt;<span style=color:#f92672>li</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;nav-item&#34;</span>&gt;
</span></span><span style=display:flex><span>            &lt;<span style=color:#f92672>Link</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;nav-link&#34;</span> <span style=color:#a6e22e>href</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;/write&#34;</span>&gt;
</span></span><span style=display:flex><span>              <span style=color:#a6e22e>Write</span>
</span></span><span style=display:flex><span>            &lt;/<span style=color:#f92672>Link</span>&gt;
</span></span><span style=display:flex><span>          &lt;/<span style=color:#f92672>li</span>&gt;
</span></span><span style=display:flex><span>        &lt;/<span style=color:#f92672>ul</span>&gt;
</span></span><span style=display:flex><span>      &lt;/<span style=color:#f92672>nav</span>&gt;
</span></span><span style=display:flex><span>    &lt;/<span style=color:#f92672>div</span>&gt;
</span></span><span style=display:flex><span>  )
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>default</span> <span style=color:#a6e22e>Nav</span>
</span></span></code></pre></div><p>之后分别在<code>views</code>目录中新建<code>Posts.tsx</code>,<code>Category.tsx</code>,<code>Write.tsx</code>文件,这些文件用于渲染文章列表,分类列表,写文章页面</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-tsx data-lang=tsx><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>Posts</span> <span style=color:#f92672>=</span> () <span style=color:#f92672>=&gt;</span> {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> &lt;<span style=color:#f92672>div</span>&gt;<span style=color:#a6e22e>Post</span>&lt;/<span style=color:#f92672>div</span>&gt;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>default</span> <span style=color:#a6e22e>Posts</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-tsx data-lang=tsx><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>Category</span> <span style=color:#f92672>=</span> () <span style=color:#f92672>=&gt;</span> {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> &lt;<span style=color:#f92672>div</span>&gt;<span style=color:#a6e22e>Category</span>&lt;/<span style=color:#f92672>div</span>&gt;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>default</span> <span style=color:#a6e22e>Category</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-tsx data-lang=tsx><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>Write</span> <span style=color:#f92672>=</span> () <span style=color:#f92672>=&gt;</span> {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> () <span style=color:#f92672>=&gt;</span> &lt;<span style=color:#f92672>div</span>&gt;<span style=color:#a6e22e>Write</span>&lt;/<span style=color:#f92672>div</span>&gt;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>default</span> <span style=color:#a6e22e>Write</span>
</span></span></code></pre></div><p>然后我们需要在<code>router</code>目录中编写路由数组</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-tsx data-lang=tsx><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>routes</span>: <span style=color:#66d9ef>RouteDefinition</span>[] <span style=color:#f92672>=</span> [
</span></span><span style=display:flex><span>  {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>path</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;/login&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>component</span><span style=color:#f92672>:</span> () <span style=color:#f92672>=&gt;</span> &lt;<span style=color:#f92672>Login</span> /&gt;
</span></span><span style=display:flex><span>  },
</span></span><span style=display:flex><span>  {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>path</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;/register&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>component</span><span style=color:#f92672>:</span> () <span style=color:#f92672>=&gt;</span> &lt;<span style=color:#f92672>Register</span> /&gt;
</span></span><span style=display:flex><span>  },
</span></span><span style=display:flex><span>  {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>path</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;/&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>component</span><span style=color:#f92672>:</span> () <span style=color:#f92672>=&gt;</span> &lt;<span style=color:#f92672>HomeLayout</span> /&gt;,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>children</span><span style=color:#f92672>:</span> [
</span></span><span style=display:flex><span>      {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>path</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;/&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>component</span><span style=color:#f92672>:</span> () <span style=color:#f92672>=&gt;</span> &lt;<span style=color:#f92672>Posts</span> /&gt;
</span></span><span style=display:flex><span>      },
</span></span><span style=display:flex><span>      {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>path</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;/category&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>component</span><span style=color:#f92672>:</span> () <span style=color:#f92672>=&gt;</span> &lt;<span style=color:#f92672>Category</span> /&gt;
</span></span><span style=display:flex><span>      },
</span></span><span style=display:flex><span>      {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>path</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;/write&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>component</span><span style=color:#f92672>:</span> () <span style=color:#f92672>=&gt;</span> &lt;<span style=color:#f92672>Write</span> /&gt;
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>    ]
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>]
</span></span></code></pre></div><h3 id=编写发布文章页面>编写发布文章页面</h3><p>在编写页面之前,需要将<code>TanStack Query</code>的<code>QueryClientProvider</code>组件放到<code>App.tsx</code>中</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-tsx data-lang=tsx><span style=display:flex><span><span style=color:#66d9ef>import</span> <span style=color:#66d9ef>type</span> { <span style=color:#a6e22e>Component</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#34;solid-js&#34;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>Router</span>, <span style=color:#a6e22e>useRoutes</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#34;@solidjs/router&#34;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> <span style=color:#a6e22e>routes</span> <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#34;./router&#34;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>Toaster</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#34;solid-toast&#34;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>QueryClient</span>, <span style=color:#a6e22e>QueryClientProvider</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#34;@tanstack/solid-query&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>App</span>: <span style=color:#66d9ef>Component</span> <span style=color:#f92672>=</span> () <span style=color:#f92672>=&gt;</span> {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>queryClient</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>QueryClient</span>()
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>Routes</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>useRoutes</span>(<span style=color:#a6e22e>routes</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> (
</span></span><span style=display:flex><span>    &lt;&gt;
</span></span><span style=display:flex><span>      &lt;<span style=color:#f92672>Toaster</span> /&gt;
</span></span><span style=display:flex><span>      {<span style=color:#75715e>/* 这里使用了QueryClientProvider组件,这个组件用于提供QueryClient,这个组件必须放在Router组件的外面 */</span>}
</span></span><span style=display:flex><span>      &lt;<span style=color:#f92672>QueryClientProvider</span> <span style=color:#a6e22e>client</span><span style=color:#f92672>=</span>{<span style=color:#a6e22e>queryClient</span>}&gt;
</span></span><span style=display:flex><span>        &lt;<span style=color:#f92672>Router</span>&gt;
</span></span><span style=display:flex><span>          &lt;<span style=color:#f92672>Routes</span> /&gt;
</span></span><span style=display:flex><span>        &lt;/<span style=color:#f92672>Router</span>&gt;
</span></span><span style=display:flex><span>      &lt;/<span style=color:#f92672>QueryClientProvider</span>&gt;
</span></span><span style=display:flex><span>    &lt;/&gt;
</span></span><span style=display:flex><span>  )
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>default</span> <span style=color:#a6e22e>App</span>
</span></span></code></pre></div><p>首先需要明确一点,<code>TanStack Query</code>在<code>SolidJS</code>中的响应并不支持解构</p><p>不支持这样</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ts data-lang=ts><span style=display:flex><span><span style=color:#66d9ef>const</span> { <span style=color:#a6e22e>isLoading</span>, <span style=color:#a6e22e>error</span>, <span style=color:#a6e22e>data</span> } <span style=color:#f92672>=</span> <span style=color:#a6e22e>useQuery</span>(...)
</span></span></code></pre></div><p>只能这样</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ts data-lang=ts><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>query</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>createQuery</span>(...)
</span></span></code></pre></div><p>然后在<code>Write.tsx</code>中编写发布文章页面</p><p>在开始之前,需要向<code>Category</code>中插入 3 条数据</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#66d9ef>insert</span> <span style=color:#66d9ef>into</span> category(id, name)
</span></span><span style=display:flex><span><span style=color:#66d9ef>values</span> (uuid(), <span style=color:#e6db74>&#39;Category 1&#39;</span>);
</span></span><span style=display:flex><span><span style=color:#66d9ef>insert</span> <span style=color:#66d9ef>into</span> category(id, name)
</span></span><span style=display:flex><span><span style=color:#66d9ef>values</span> (uuid(), <span style=color:#e6db74>&#39;Category 2&#39;</span>);
</span></span><span style=display:flex><span><span style=color:#66d9ef>insert</span> <span style=color:#66d9ef>into</span> category(id, name)
</span></span><span style=display:flex><span><span style=color:#66d9ef>values</span> (uuid(), <span style=color:#e6db74>&#39;Category 3&#39;</span>);
</span></span></code></pre></div><p>发帖页面的代码如下</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-tsx data-lang=tsx><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>createQuery</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#34;@tanstack/solid-query&#34;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>api</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#34;../common/ApiInstance&#34;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>PostInput</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#34;../__generated/model/static&#34;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>createImmerSignal</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#34;solid-immer&#34;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>For</span>, <span style=color:#a6e22e>Match</span>, <span style=color:#a6e22e>Switch</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#34;solid-js&#34;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>useNavigate</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#34;@solidjs/router&#34;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> <span style=color:#a6e22e>toast</span> <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#34;solid-toast&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>Write</span> <span style=color:#f92672>=</span> () <span style=color:#f92672>=&gt;</span> {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>navigate</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>useNavigate</span>()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> [<span style=color:#a6e22e>form</span>, <span style=color:#a6e22e>setForm</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>createImmerSignal</span>&lt;<span style=color:#f92672>PostInput</span>&gt;({}) <span style=color:#75715e>//这个函数用于创建一个信号,这个信号用于存储表单数据
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>formRef</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>categories</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>createQuery</span>({
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>queryKey</span><span style=color:#f92672>:</span> () <span style=color:#f92672>=&gt;</span> [<span style=color:#e6db74>&#34;category&#34;</span>],
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>queryFn</span><span style=color:#f92672>:</span> () <span style=color:#f92672>=&gt;</span> <span style=color:#a6e22e>api</span>.<span style=color:#a6e22e>categoryController</span>.<span style=color:#a6e22e>findCategories</span>()
</span></span><span style=display:flex><span>  })
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>submit</span> <span style=color:#f92672>=</span> (<span style=color:#a6e22e>e</span>) <span style=color:#f92672>=&gt;</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>e</span>.<span style=color:#a6e22e>preventDefault</span>()
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>e</span>.<span style=color:#a6e22e>stopPropagation</span>()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>formRef</span>.<span style=color:#a6e22e>checkValidity</span>()) {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>api</span>.<span style=color:#a6e22e>postController</span>
</span></span><span style=display:flex><span>        .<span style=color:#a6e22e>createPost</span>({ <span style=color:#a6e22e>body</span>: <span style=color:#66d9ef>form</span>() })
</span></span><span style=display:flex><span>        .<span style=color:#a6e22e>then</span>(() <span style=color:#f92672>=&gt;</span> {
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>toast</span>.<span style=color:#a6e22e>success</span>(<span style=color:#e6db74>&#34;Publish success&#34;</span>)
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>navigate</span>(<span style=color:#e6db74>&#34;/&#34;</span>)
</span></span><span style=display:flex><span>        })
</span></span><span style=display:flex><span>        .<span style=color:#66d9ef>catch</span>((<span style=color:#a6e22e>err</span>) <span style=color:#f92672>=&gt;</span> {
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>toast</span>.<span style=color:#a6e22e>error</span>(<span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>        })
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>formRef</span>.<span style=color:#a6e22e>classList</span>.<span style=color:#a6e22e>add</span>(<span style=color:#e6db74>&#34;was-validated&#34;</span>)
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> () <span style=color:#f92672>=&gt;</span> (
</span></span><span style=display:flex><span>    &lt;<span style=color:#f92672>div</span>&gt;
</span></span><span style=display:flex><span>      &lt;<span style=color:#f92672>form</span> <span style=color:#a6e22e>ref</span><span style=color:#f92672>=</span>{<span style=color:#a6e22e>formRef</span>} <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;needs-validation&#34;</span> <span style=color:#a6e22e>novalidate</span>&gt;
</span></span><span style=display:flex><span>        &lt;<span style=color:#f92672>div</span>&gt;
</span></span><span style=display:flex><span>          &lt;<span style=color:#f92672>label</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;form-label&#34;</span>&gt;<span style=color:#a6e22e>Title</span>&lt;/<span style=color:#f92672>label</span>&gt;
</span></span><span style=display:flex><span>          &lt;<span style=color:#f92672>input</span>
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>type</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;text&#34;</span>
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;form-control&#34;</span>
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>required</span>
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>onInput</span><span style=color:#f92672>=</span>{(<span style=color:#a6e22e>e</span>) <span style=color:#f92672>=&gt;</span> <span style=color:#a6e22e>setForm</span>((<span style=color:#a6e22e>draft</span>) <span style=color:#f92672>=&gt;</span> (<span style=color:#a6e22e>draft</span>.<span style=color:#a6e22e>title</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>e</span>.<span style=color:#a6e22e>currentTarget</span>.<span style=color:#a6e22e>value</span>))}
</span></span><span style=display:flex><span>          /&gt;
</span></span><span style=display:flex><span>          &lt;<span style=color:#f92672>div</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;valid-feedback&#34;</span>&gt;<span style=color:#a6e22e>Looks</span> <span style=color:#a6e22e>good</span><span style=color:#f92672>!</span>&lt;/<span style=color:#f92672>div</span>&gt;
</span></span><span style=display:flex><span>          &lt;<span style=color:#f92672>div</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;invalid-feedback&#34;</span>&gt;<span style=color:#a6e22e>Please</span> <span style=color:#a6e22e>enter</span> <span style=color:#a6e22e>title</span>.&lt;/<span style=color:#f92672>div</span>&gt;
</span></span><span style=display:flex><span>        &lt;/<span style=color:#f92672>div</span>&gt;
</span></span><span style=display:flex><span>        &lt;<span style=color:#f92672>div</span>&gt;
</span></span><span style=display:flex><span>          &lt;<span style=color:#f92672>label</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;form-label&#34;</span>&gt;<span style=color:#a6e22e>Content</span>&lt;/<span style=color:#f92672>label</span>&gt;
</span></span><span style=display:flex><span>          &lt;<span style=color:#f92672>textarea</span>
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;form-control&#34;</span>
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>style</span><span style=color:#f92672>=</span>{{ <span style=color:#a6e22e>height</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;16rem&#34;</span> }}
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>required</span>
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>onInput</span><span style=color:#f92672>=</span>{(<span style=color:#a6e22e>e</span>) <span style=color:#f92672>=&gt;</span> <span style=color:#a6e22e>setForm</span>((<span style=color:#a6e22e>draft</span>) <span style=color:#f92672>=&gt;</span> (<span style=color:#a6e22e>draft</span>.<span style=color:#a6e22e>content</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>e</span>.<span style=color:#a6e22e>currentTarget</span>.<span style=color:#a6e22e>value</span>))}
</span></span><span style=display:flex><span>          /&gt;
</span></span><span style=display:flex><span>          &lt;<span style=color:#f92672>div</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;valid-feedback&#34;</span>&gt;<span style=color:#a6e22e>Looks</span> <span style=color:#a6e22e>good</span><span style=color:#f92672>!</span>&lt;/<span style=color:#f92672>div</span>&gt;
</span></span><span style=display:flex><span>          &lt;<span style=color:#f92672>div</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;invalid-feedback&#34;</span>&gt;<span style=color:#a6e22e>Please</span> <span style=color:#a6e22e>enter</span> <span style=color:#a6e22e>content</span>.&lt;/<span style=color:#f92672>div</span>&gt;
</span></span><span style=display:flex><span>        &lt;/<span style=color:#f92672>div</span>&gt;
</span></span><span style=display:flex><span>        &lt;<span style=color:#f92672>div</span>&gt;
</span></span><span style=display:flex><span>          &lt;<span style=color:#f92672>label</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;form-label&#34;</span>&gt;<span style=color:#a6e22e>Category</span>&lt;/<span style=color:#f92672>label</span>&gt;
</span></span><span style=display:flex><span>          {<span style=color:#75715e>/* 这里使用了Switch组件,这个组件用于根据条件渲染不同的内容 */</span>}
</span></span><span style=display:flex><span>          &lt;<span style=color:#f92672>Switch</span>&gt;
</span></span><span style=display:flex><span>            {<span style=color:#75715e>/* 这里使用了Match组件,这个组件用于匹配条件,如果条件为true,那么就渲染加载 */</span>}
</span></span><span style=display:flex><span>            &lt;<span style=color:#f92672>Match</span> <span style=color:#a6e22e>when</span><span style=color:#f92672>=</span>{<span style=color:#a6e22e>categories</span>.<span style=color:#a6e22e>isLoading</span>}&gt;
</span></span><span style=display:flex><span>              &lt;<span style=color:#f92672>div</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;spinner-border&#34;</span> <span style=color:#a6e22e>role</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;status&#34;</span>&gt;
</span></span><span style=display:flex><span>                &lt;<span style=color:#f92672>span</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;visually-hidden&#34;</span>&gt;<span style=color:#a6e22e>Loading</span>...&lt;/<span style=color:#f92672>span</span>&gt;
</span></span><span style=display:flex><span>              &lt;/<span style=color:#f92672>div</span>&gt;
</span></span><span style=display:flex><span>            &lt;/<span style=color:#f92672>Match</span>&gt;
</span></span><span style=display:flex><span>            &lt;<span style=color:#f92672>Match</span> <span style=color:#a6e22e>when</span><span style=color:#f92672>=</span>{<span style=color:#a6e22e>categories</span>.<span style=color:#a6e22e>isError</span>}&gt;Error&lt;/<span style=color:#f92672>Match</span>&gt;
</span></span><span style=display:flex><span>            &lt;<span style=color:#f92672>Match</span> <span style=color:#a6e22e>when</span><span style=color:#f92672>=</span>{<span style=color:#a6e22e>categories</span>.<span style=color:#a6e22e>isSuccess</span>}&gt;
</span></span><span style=display:flex><span>              &lt;<span style=color:#f92672>select</span>
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;form-select&#34;</span>
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>value</span><span style=color:#f92672>=</span>{<span style=color:#a6e22e>form</span>().<span style=color:#a6e22e>categoryId</span>}
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>onInput</span><span style=color:#f92672>=</span>{(<span style=color:#a6e22e>e</span>) <span style=color:#f92672>=&gt;</span>
</span></span><span style=display:flex><span>                  <span style=color:#a6e22e>setForm</span>((<span style=color:#a6e22e>draft</span>) <span style=color:#f92672>=&gt;</span> {
</span></span><span style=display:flex><span>                    <span style=color:#a6e22e>draft</span>.<span style=color:#a6e22e>categoryId</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>e</span>.<span style=color:#a6e22e>currentTarget</span>.<span style=color:#a6e22e>value</span>
</span></span><span style=display:flex><span>                  })
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>required</span>
</span></span><span style=display:flex><span>              &gt;
</span></span><span style=display:flex><span>                &lt;<span style=color:#f92672>For</span> <span style=color:#a6e22e>each</span><span style=color:#f92672>=</span>{<span style=color:#a6e22e>categories</span>.<span style=color:#a6e22e>data</span>}&gt;{(<span style=color:#a6e22e>item</span>) <span style=color:#f92672>=&gt;</span> &lt;<span style=color:#f92672>option</span> <span style=color:#a6e22e>value</span><span style=color:#f92672>=</span>{<span style=color:#a6e22e>item</span>.<span style=color:#a6e22e>id</span>}&gt;{<span style=color:#a6e22e>item</span>.<span style=color:#a6e22e>name</span>}&lt;/<span style=color:#f92672>option</span>&gt;}&lt;/<span style=color:#f92672>For</span>&gt;
</span></span><span style=display:flex><span>              &lt;/<span style=color:#f92672>select</span>&gt;
</span></span><span style=display:flex><span>            &lt;/<span style=color:#f92672>Match</span>&gt;
</span></span><span style=display:flex><span>          &lt;/<span style=color:#f92672>Switch</span>&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>          &lt;<span style=color:#f92672>div</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;valid-feedback&#34;</span>&gt;<span style=color:#a6e22e>Looks</span> <span style=color:#a6e22e>good</span><span style=color:#f92672>!</span>&lt;/<span style=color:#f92672>div</span>&gt;
</span></span><span style=display:flex><span>          &lt;<span style=color:#f92672>div</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;invalid-feedback&#34;</span>&gt;<span style=color:#a6e22e>Please</span> <span style=color:#a6e22e>select</span> <span style=color:#a6e22e>category</span>.&lt;/<span style=color:#f92672>div</span>&gt;
</span></span><span style=display:flex><span>        &lt;/<span style=color:#f92672>div</span>&gt;
</span></span><span style=display:flex><span>        &lt;<span style=color:#f92672>button</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;btn btn-primary&#34;</span> <span style=color:#a6e22e>type</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;submit&#34;</span> <span style=color:#a6e22e>onClick</span><span style=color:#f92672>=</span>{<span style=color:#a6e22e>submit</span>}&gt;
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>Publish</span>
</span></span><span style=display:flex><span>        &lt;/<span style=color:#f92672>button</span>&gt;
</span></span><span style=display:flex><span>      &lt;/<span style=color:#f92672>form</span>&gt;
</span></span><span style=display:flex><span>    &lt;/<span style=color:#f92672>div</span>&gt;
</span></span><span style=display:flex><span>  )
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>default</span> <span style=color:#a6e22e>Write</span>
</span></span></code></pre></div><h3 id=编写文章详情页面>编写文章详情页面</h3><p>在<code>views</code>目录下创建<code>Post.tsx</code>文件</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-tsx data-lang=tsx><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>useParams</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#34;@solidjs/router&#34;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>createQuery</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#34;@tanstack/solid-query&#34;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>api</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#34;../common/ApiInstance&#34;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>Match</span>, <span style=color:#a6e22e>Switch</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#34;solid-js&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>Post</span> <span style=color:#f92672>=</span> () <span style=color:#f92672>=&gt;</span> {
</span></span><span style=display:flex><span>  <span style=color:#75715e>//这里使用了useParams函数,这个函数用于获取路由参数
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>params</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>useParams</span>()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>post</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>createQuery</span>({
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>queryKey</span><span style=color:#f92672>:</span> () <span style=color:#f92672>=&gt;</span> [<span style=color:#e6db74>&#34;post&#34;</span>, <span style=color:#a6e22e>params</span>.<span style=color:#a6e22e>id</span>],
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>queryFn</span><span style=color:#f92672>:</span> () <span style=color:#f92672>=&gt;</span> <span style=color:#a6e22e>api</span>.<span style=color:#a6e22e>postController</span>.<span style=color:#a6e22e>findPost</span>({ <span style=color:#a6e22e>id</span>: <span style=color:#66d9ef>params.id</span> })
</span></span><span style=display:flex><span>  })
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> (
</span></span><span style=display:flex><span>    &lt;<span style=color:#f92672>div</span>&gt;
</span></span><span style=display:flex><span>      &lt;<span style=color:#f92672>Switch</span>&gt;
</span></span><span style=display:flex><span>        &lt;<span style=color:#f92672>Match</span> <span style=color:#a6e22e>when</span><span style=color:#f92672>=</span>{<span style=color:#a6e22e>post</span>.<span style=color:#a6e22e>isLoading</span>}&gt;
</span></span><span style=display:flex><span>          &lt;<span style=color:#f92672>div</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;spinner-border&#34;</span> <span style=color:#a6e22e>role</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;status&#34;</span>&gt;
</span></span><span style=display:flex><span>            &lt;<span style=color:#f92672>span</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;visually-hidden&#34;</span>&gt;<span style=color:#a6e22e>Loading</span>...&lt;/<span style=color:#f92672>span</span>&gt;
</span></span><span style=display:flex><span>          &lt;/<span style=color:#f92672>div</span>&gt;
</span></span><span style=display:flex><span>        &lt;/<span style=color:#f92672>Match</span>&gt;
</span></span><span style=display:flex><span>        &lt;<span style=color:#f92672>Match</span> <span style=color:#a6e22e>when</span><span style=color:#f92672>=</span>{<span style=color:#a6e22e>post</span>.<span style=color:#a6e22e>isError</span>}&gt;Error&lt;/<span style=color:#f92672>Match</span>&gt;
</span></span><span style=display:flex><span>        &lt;<span style=color:#f92672>Match</span> <span style=color:#a6e22e>when</span><span style=color:#f92672>=</span>{<span style=color:#a6e22e>post</span>.<span style=color:#a6e22e>isSuccess</span>}&gt;
</span></span><span style=display:flex><span>          &lt;<span style=color:#f92672>div</span>&gt;{<span style=color:#a6e22e>post</span>.<span style=color:#a6e22e>data</span>.<span style=color:#a6e22e>title</span>}&lt;/<span style=color:#f92672>div</span>&gt;
</span></span><span style=display:flex><span>          &lt;<span style=color:#f92672>div</span>&gt;{<span style=color:#a6e22e>post</span>.<span style=color:#a6e22e>data</span>.<span style=color:#a6e22e>category</span>.<span style=color:#a6e22e>name</span>}&lt;/<span style=color:#f92672>div</span>&gt;
</span></span><span style=display:flex><span>          &lt;<span style=color:#f92672>div</span>&gt;{<span style=color:#a6e22e>post</span>.<span style=color:#a6e22e>data</span>.<span style=color:#a6e22e>content</span>}&lt;/<span style=color:#f92672>div</span>&gt;
</span></span><span style=display:flex><span>        &lt;/<span style=color:#f92672>Match</span>&gt;
</span></span><span style=display:flex><span>      &lt;/<span style=color:#f92672>Switch</span>&gt;
</span></span><span style=display:flex><span>    &lt;/<span style=color:#f92672>div</span>&gt;
</span></span><span style=display:flex><span>  )
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>default</span> <span style=color:#a6e22e>Post</span>
</span></span></code></pre></div><p>之后在<code>router</code>目录中添加一个路由,布局是<code>HomeLayout</code>,路径是<code>/post/:id</code>,组件是<code>Post</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-tsx data-lang=tsx><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>path</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;/post/:id&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>component</span><span style=color:#f92672>:</span> () <span style=color:#f92672>=&gt;</span> &lt;<span style=color:#f92672>Post</span> /&gt;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=编写文章列表页面>编写文章列表页面</h3><p>在<code>Posts.tsx</code>中编写文章列表页面,这里使用了<code>RequestOf</code>,这个类型用于获取请求的参数类型,这个类型是<code>Jimmer</code>自动生成的,比如<code>RequestOf&lt;typeof api.postController.findPosts></code>的类型就是<code>{ page?: number; size?: number; }</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-tsx data-lang=tsx><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>createImmerSignal</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#34;solid-immer&#34;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>RequestOf</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#34;../__generated&#34;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>api</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#34;../common/ApiInstance&#34;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>createQuery</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#34;@tanstack/solid-query&#34;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>For</span>, <span style=color:#a6e22e>Match</span>, <span style=color:#a6e22e>Switch</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#34;solid-js&#34;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>Link</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#34;@solidjs/router&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>Posts</span> <span style=color:#f92672>=</span> () <span style=color:#f92672>=&gt;</span> {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> [<span style=color:#a6e22e>options</span>, <span style=color:#a6e22e>setOptions</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>createImmerSignal</span>&lt;<span style=color:#f92672>RequestOf</span><span style=color:#960050;background-color:#1e0010>&lt;</span><span style=color:#a6e22e>typeof</span> <span style=color:#a6e22e>api.postController.findPosts</span>&gt;<span style=color:#f92672>&gt;</span>({})
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>posts</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>createQuery</span>({
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>queryKey</span><span style=color:#f92672>:</span> () <span style=color:#f92672>=&gt;</span> [<span style=color:#e6db74>&#34;posts&#34;</span>, <span style=color:#a6e22e>options</span>()],
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>queryFn</span><span style=color:#f92672>:</span> () <span style=color:#f92672>=&gt;</span> <span style=color:#a6e22e>api</span>.<span style=color:#a6e22e>postController</span>.<span style=color:#a6e22e>findPosts</span>(<span style=color:#a6e22e>options</span>())
</span></span><span style=display:flex><span>  })
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> (
</span></span><span style=display:flex><span>    &lt;&gt;
</span></span><span style=display:flex><span>      &lt;<span style=color:#f92672>Switch</span>&gt;
</span></span><span style=display:flex><span>        &lt;<span style=color:#f92672>Match</span> <span style=color:#a6e22e>when</span><span style=color:#f92672>=</span>{<span style=color:#a6e22e>posts</span>.<span style=color:#a6e22e>isLoading</span>}&gt;
</span></span><span style=display:flex><span>          &lt;<span style=color:#f92672>div</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;spinner-border&#34;</span> <span style=color:#a6e22e>role</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;status&#34;</span>&gt;
</span></span><span style=display:flex><span>            &lt;<span style=color:#f92672>span</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;visually-hidden&#34;</span>&gt;<span style=color:#a6e22e>Loading</span>...&lt;/<span style=color:#f92672>span</span>&gt;
</span></span><span style=display:flex><span>          &lt;/<span style=color:#f92672>div</span>&gt;
</span></span><span style=display:flex><span>        &lt;/<span style=color:#f92672>Match</span>&gt;
</span></span><span style=display:flex><span>        &lt;<span style=color:#f92672>Match</span> <span style=color:#a6e22e>when</span><span style=color:#f92672>=</span>{<span style=color:#a6e22e>posts</span>.<span style=color:#a6e22e>isError</span>}&gt;Error&lt;/<span style=color:#f92672>Match</span>&gt;
</span></span><span style=display:flex><span>        &lt;<span style=color:#f92672>Match</span> <span style=color:#a6e22e>when</span><span style=color:#f92672>=</span>{<span style=color:#a6e22e>posts</span>.<span style=color:#a6e22e>isSuccess</span>}&gt;
</span></span><span style=display:flex><span>          &lt;<span style=color:#f92672>ul</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;list-group&#34;</span>&gt;
</span></span><span style=display:flex><span>            &lt;<span style=color:#f92672>For</span> <span style=color:#a6e22e>each</span><span style=color:#f92672>=</span>{<span style=color:#a6e22e>posts</span>.<span style=color:#a6e22e>data</span>.<span style=color:#a6e22e>content</span>}&gt;
</span></span><span style=display:flex><span>              {(<span style=color:#a6e22e>post</span>) <span style=color:#f92672>=&gt;</span> (
</span></span><span style=display:flex><span>                &lt;<span style=color:#f92672>li</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;list-group-item&#34;</span>&gt;
</span></span><span style=display:flex><span>                  {<span style=color:#75715e>/* 这里使用了Link组件,这个组件用于跳转路由,这里使用了post.id作为参数 */</span>}
</span></span><span style=display:flex><span>                  &lt;<span style=color:#f92672>Link</span> <span style=color:#a6e22e>href</span><span style=color:#f92672>=</span>{<span style=color:#e6db74>`/post/</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>post</span>.<span style=color:#a6e22e>id</span><span style=color:#e6db74>}</span><span style=color:#e6db74>`</span>}&gt;{<span style=color:#a6e22e>post</span>.<span style=color:#a6e22e>title</span>}&lt;/<span style=color:#f92672>Link</span>&gt;
</span></span><span style=display:flex><span>                &lt;/<span style=color:#f92672>li</span>&gt;
</span></span><span style=display:flex><span>              )}
</span></span><span style=display:flex><span>            &lt;/<span style=color:#f92672>For</span>&gt;
</span></span><span style=display:flex><span>          &lt;/<span style=color:#f92672>ul</span>&gt;
</span></span><span style=display:flex><span>          {<span style=color:#75715e>/* 分页 */</span>}
</span></span><span style=display:flex><span>          &lt;<span style=color:#f92672>nav</span> <span style=color:#a6e22e>aria-label</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;Page navigation example&#34;</span>&gt;
</span></span><span style=display:flex><span>            &lt;<span style=color:#f92672>ul</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;pagination&#34;</span>&gt;
</span></span><span style=display:flex><span>              &lt;<span style=color:#f92672>li</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;page-item&#34;</span>&gt;
</span></span><span style=display:flex><span>                &lt;<span style=color:#f92672>div</span>
</span></span><span style=display:flex><span>                  <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;page-link&#34;</span>
</span></span><span style=display:flex><span>                  <span style=color:#a6e22e>onClick</span><span style=color:#f92672>=</span>{() <span style=color:#f92672>=&gt;</span> {
</span></span><span style=display:flex><span>                    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>options</span>().<span style=color:#a6e22e>page</span> <span style=color:#f92672>??</span> <span style=color:#ae81ff>0</span> <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>0</span>)
</span></span><span style=display:flex><span>                      <span style=color:#a6e22e>setOptions</span>((<span style=color:#a6e22e>draft</span>) <span style=color:#f92672>=&gt;</span> {
</span></span><span style=display:flex><span>                        <span style=color:#a6e22e>draft</span>.<span style=color:#a6e22e>page</span> <span style=color:#f92672>=</span> (<span style=color:#a6e22e>options</span>().<span style=color:#a6e22e>page</span> <span style=color:#f92672>??</span> <span style=color:#ae81ff>0</span>) <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>                      })
</span></span><span style=display:flex><span>                  }}
</span></span><span style=display:flex><span>                &gt;
</span></span><span style=display:flex><span>                  <span style=color:#a6e22e>Previous</span>
</span></span><span style=display:flex><span>                &lt;/<span style=color:#f92672>div</span>&gt;
</span></span><span style=display:flex><span>              &lt;/<span style=color:#f92672>li</span>&gt;
</span></span><span style=display:flex><span>              {<span style=color:#75715e>/* 这里使用了For组件,一共有几页就渲染几页,这里使用了Array.from方法,这个方法用于将一个数字转换为数组,比如Array.from({length: 3})的结果就是[1,2,3] */</span>}
</span></span><span style=display:flex><span>              &lt;<span style=color:#f92672>For</span> <span style=color:#a6e22e>each</span><span style=color:#f92672>=</span>{Array.<span style=color:#66d9ef>from</span>({ <span style=color:#a6e22e>length</span>: <span style=color:#66d9ef>posts.data.totalPages</span> }, (<span style=color:#a6e22e>_</span>, <span style=color:#a6e22e>i</span>) <span style=color:#f92672>=&gt;</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>)}&gt;
</span></span><span style=display:flex><span>                {(<span style=color:#a6e22e>page</span>, <span style=color:#a6e22e>index</span>) <span style=color:#f92672>=&gt;</span> (
</span></span><span style=display:flex><span>                  &lt;<span style=color:#f92672>li</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;page-item&#34;</span>&gt;
</span></span><span style=display:flex><span>                    &lt;<span style=color:#f92672>div</span>
</span></span><span style=display:flex><span>                      <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;page-link&#34;</span>
</span></span><span style=display:flex><span>                      <span style=color:#a6e22e>classList</span><span style=color:#f92672>=</span>{{ <span style=color:#a6e22e>active</span><span style=color:#f92672>:</span> (<span style=color:#a6e22e>options</span>().<span style=color:#a6e22e>page</span> <span style=color:#f92672>??</span> <span style=color:#ae81ff>0</span>) <span style=color:#f92672>===</span> <span style=color:#a6e22e>index</span>() }}
</span></span><span style=display:flex><span>                      <span style=color:#a6e22e>onClick</span><span style=color:#f92672>=</span>{() <span style=color:#f92672>=&gt;</span>
</span></span><span style=display:flex><span>                        <span style=color:#a6e22e>setOptions</span>((<span style=color:#a6e22e>draft</span>) <span style=color:#f92672>=&gt;</span> {
</span></span><span style=display:flex><span>                          <span style=color:#a6e22e>draft</span>.<span style=color:#a6e22e>page</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>index</span>()
</span></span><span style=display:flex><span>                        })
</span></span><span style=display:flex><span>                      }
</span></span><span style=display:flex><span>                    &gt;
</span></span><span style=display:flex><span>                      {<span style=color:#a6e22e>page</span>}
</span></span><span style=display:flex><span>                    &lt;/<span style=color:#f92672>div</span>&gt;
</span></span><span style=display:flex><span>                  &lt;/<span style=color:#f92672>li</span>&gt;
</span></span><span style=display:flex><span>                )}
</span></span><span style=display:flex><span>              &lt;/<span style=color:#f92672>For</span>&gt;
</span></span><span style=display:flex><span>              &lt;<span style=color:#f92672>li</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;page-item&#34;</span>&gt;
</span></span><span style=display:flex><span>                &lt;<span style=color:#f92672>div</span>
</span></span><span style=display:flex><span>                  <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;page-link&#34;</span>
</span></span><span style=display:flex><span>                  <span style=color:#a6e22e>onClick</span><span style=color:#f92672>=</span>{() <span style=color:#f92672>=&gt;</span> {
</span></span><span style=display:flex><span>                    <span style=color:#66d9ef>if</span> ((<span style=color:#a6e22e>options</span>().<span style=color:#a6e22e>page</span> <span style=color:#f92672>??</span> <span style=color:#ae81ff>0</span>) <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>posts</span>.<span style=color:#a6e22e>data</span>.<span style=color:#a6e22e>totalPages</span> <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>)
</span></span><span style=display:flex><span>                      <span style=color:#a6e22e>setOptions</span>((<span style=color:#a6e22e>draft</span>) <span style=color:#f92672>=&gt;</span> {
</span></span><span style=display:flex><span>                        <span style=color:#a6e22e>draft</span>.<span style=color:#a6e22e>page</span> <span style=color:#f92672>=</span> (<span style=color:#a6e22e>options</span>().<span style=color:#a6e22e>page</span> <span style=color:#f92672>??</span> <span style=color:#ae81ff>0</span>) <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>                      })
</span></span><span style=display:flex><span>                  }}
</span></span><span style=display:flex><span>                &gt;
</span></span><span style=display:flex><span>                  <span style=color:#a6e22e>Next</span>
</span></span><span style=display:flex><span>                &lt;/<span style=color:#f92672>div</span>&gt;
</span></span><span style=display:flex><span>              &lt;/<span style=color:#f92672>li</span>&gt;
</span></span><span style=display:flex><span>            &lt;/<span style=color:#f92672>ul</span>&gt;
</span></span><span style=display:flex><span>          &lt;/<span style=color:#f92672>nav</span>&gt;
</span></span><span style=display:flex><span>        &lt;/<span style=color:#f92672>Match</span>&gt;
</span></span><span style=display:flex><span>      &lt;/<span style=color:#f92672>Switch</span>&gt;
</span></span><span style=display:flex><span>    &lt;/&gt;
</span></span><span style=display:flex><span>  )
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>default</span> <span style=color:#a6e22e>Posts</span>
</span></span></code></pre></div><h3 id=编写分类列表页面>编写分类列表页面</h3><p>在<code>Category.tsx</code>中编写分类列表页面,这里为了方便,我直接将<code>Posts.tsx</code>中的代码复制过来了,然后修改了一下请求参数</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-tsx data-lang=tsx><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>createImmerSignal</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#34;solid-immer&#34;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>RequestOf</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#34;../__generated&#34;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>createQuery</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#34;@tanstack/solid-query&#34;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>api</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#34;../common/ApiInstance&#34;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>Link</span>, <span style=color:#a6e22e>useParams</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#34;@solidjs/router&#34;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>Switch</span>, <span style=color:#a6e22e>Match</span>, <span style=color:#a6e22e>For</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#34;solid-js&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>CategoryPosts</span> <span style=color:#f92672>=</span> () <span style=color:#f92672>=&gt;</span> {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>params</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>useParams</span>()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> [<span style=color:#a6e22e>options</span>, <span style=color:#a6e22e>setOptions</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>createImmerSignal</span>&lt;<span style=color:#f92672>RequestOf</span><span style=color:#960050;background-color:#1e0010>&lt;</span><span style=color:#a6e22e>typeof</span> <span style=color:#a6e22e>api.postController.findPostsByCategory</span>&gt;<span style=color:#f92672>&gt;</span>({
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>categoryId</span>: <span style=color:#66d9ef>params.categoryId</span>
</span></span><span style=display:flex><span>  })
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>posts</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>createQuery</span>({
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>queryKey</span><span style=color:#f92672>:</span> () <span style=color:#f92672>=&gt;</span> [<span style=color:#e6db74>&#34;posts&#34;</span>, <span style=color:#a6e22e>options</span>()],
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>queryFn</span><span style=color:#f92672>:</span> () <span style=color:#f92672>=&gt;</span> <span style=color:#a6e22e>api</span>.<span style=color:#a6e22e>postController</span>.<span style=color:#a6e22e>findPostsByCategory</span>(<span style=color:#a6e22e>options</span>())
</span></span><span style=display:flex><span>  })
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> (
</span></span><span style=display:flex><span>    &lt;<span style=color:#f92672>Switch</span>&gt;
</span></span><span style=display:flex><span>      &lt;<span style=color:#f92672>Match</span> <span style=color:#a6e22e>when</span><span style=color:#f92672>=</span>{<span style=color:#a6e22e>posts</span>.<span style=color:#a6e22e>isLoading</span>}&gt;
</span></span><span style=display:flex><span>        &lt;<span style=color:#f92672>div</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;spinner-border&#34;</span> <span style=color:#a6e22e>role</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;status&#34;</span>&gt;
</span></span><span style=display:flex><span>          &lt;<span style=color:#f92672>span</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;visually-hidden&#34;</span>&gt;<span style=color:#a6e22e>Loading</span>...&lt;/<span style=color:#f92672>span</span>&gt;
</span></span><span style=display:flex><span>        &lt;/<span style=color:#f92672>div</span>&gt;
</span></span><span style=display:flex><span>      &lt;/<span style=color:#f92672>Match</span>&gt;
</span></span><span style=display:flex><span>      &lt;<span style=color:#f92672>Match</span> <span style=color:#a6e22e>when</span><span style=color:#f92672>=</span>{<span style=color:#a6e22e>posts</span>.<span style=color:#a6e22e>isError</span>}&gt;Error&lt;/<span style=color:#f92672>Match</span>&gt;
</span></span><span style=display:flex><span>      &lt;<span style=color:#f92672>Match</span> <span style=color:#a6e22e>when</span><span style=color:#f92672>=</span>{<span style=color:#a6e22e>posts</span>.<span style=color:#a6e22e>isSuccess</span>}&gt;
</span></span><span style=display:flex><span>        &lt;<span style=color:#f92672>ul</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;list-group&#34;</span>&gt;
</span></span><span style=display:flex><span>          &lt;<span style=color:#f92672>For</span> <span style=color:#a6e22e>each</span><span style=color:#f92672>=</span>{<span style=color:#a6e22e>posts</span>.<span style=color:#a6e22e>data</span>.<span style=color:#a6e22e>content</span>}&gt;
</span></span><span style=display:flex><span>            {(<span style=color:#a6e22e>post</span>) <span style=color:#f92672>=&gt;</span> (
</span></span><span style=display:flex><span>              &lt;<span style=color:#f92672>li</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;list-group-item&#34;</span>&gt;
</span></span><span style=display:flex><span>                &lt;<span style=color:#f92672>Link</span> <span style=color:#a6e22e>href</span><span style=color:#f92672>=</span>{<span style=color:#e6db74>`/post/</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>post</span>.<span style=color:#a6e22e>id</span><span style=color:#e6db74>}</span><span style=color:#e6db74>`</span>}&gt;{<span style=color:#a6e22e>post</span>.<span style=color:#a6e22e>title</span>}&lt;/<span style=color:#f92672>Link</span>&gt;
</span></span><span style=display:flex><span>              &lt;/<span style=color:#f92672>li</span>&gt;
</span></span><span style=display:flex><span>            )}
</span></span><span style=display:flex><span>          &lt;/<span style=color:#f92672>For</span>&gt;
</span></span><span style=display:flex><span>        &lt;/<span style=color:#f92672>ul</span>&gt;
</span></span><span style=display:flex><span>        &lt;<span style=color:#f92672>nav</span> <span style=color:#a6e22e>aria-label</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;Page navigation example&#34;</span>&gt;
</span></span><span style=display:flex><span>          &lt;<span style=color:#f92672>ul</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;pagination&#34;</span>&gt;
</span></span><span style=display:flex><span>            &lt;<span style=color:#f92672>li</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;page-item&#34;</span>&gt;
</span></span><span style=display:flex><span>              &lt;<span style=color:#f92672>div</span>
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;page-link&#34;</span>
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>onClick</span><span style=color:#f92672>=</span>{() <span style=color:#f92672>=&gt;</span> {
</span></span><span style=display:flex><span>                  <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>options</span>().<span style=color:#a6e22e>page</span> <span style=color:#f92672>??</span> <span style=color:#ae81ff>0</span> <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>0</span>)
</span></span><span style=display:flex><span>                    <span style=color:#a6e22e>setOptions</span>((<span style=color:#a6e22e>draft</span>) <span style=color:#f92672>=&gt;</span> {
</span></span><span style=display:flex><span>                      <span style=color:#a6e22e>draft</span>.<span style=color:#a6e22e>page</span> <span style=color:#f92672>=</span> (<span style=color:#a6e22e>options</span>().<span style=color:#a6e22e>page</span> <span style=color:#f92672>??</span> <span style=color:#ae81ff>0</span>) <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>                    })
</span></span><span style=display:flex><span>                }}
</span></span><span style=display:flex><span>              &gt;
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>Previous</span>
</span></span><span style=display:flex><span>              &lt;/<span style=color:#f92672>div</span>&gt;
</span></span><span style=display:flex><span>            &lt;/<span style=color:#f92672>li</span>&gt;
</span></span><span style=display:flex><span>            &lt;<span style=color:#f92672>For</span> <span style=color:#a6e22e>each</span><span style=color:#f92672>=</span>{Array.<span style=color:#66d9ef>from</span>({ <span style=color:#a6e22e>length</span>: <span style=color:#66d9ef>posts.data.totalPages</span> }, (<span style=color:#a6e22e>_</span>, <span style=color:#a6e22e>i</span>) <span style=color:#f92672>=&gt;</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>)}&gt;
</span></span><span style=display:flex><span>              {(<span style=color:#a6e22e>page</span>, <span style=color:#a6e22e>index</span>) <span style=color:#f92672>=&gt;</span> (
</span></span><span style=display:flex><span>                &lt;<span style=color:#f92672>li</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;page-item&#34;</span>&gt;
</span></span><span style=display:flex><span>                  &lt;<span style=color:#f92672>div</span>
</span></span><span style=display:flex><span>                    <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;page-link&#34;</span>
</span></span><span style=display:flex><span>                    <span style=color:#a6e22e>classList</span><span style=color:#f92672>=</span>{{ <span style=color:#a6e22e>active</span><span style=color:#f92672>:</span> (<span style=color:#a6e22e>options</span>().<span style=color:#a6e22e>page</span> <span style=color:#f92672>??</span> <span style=color:#ae81ff>0</span>) <span style=color:#f92672>===</span> <span style=color:#a6e22e>index</span>() }}
</span></span><span style=display:flex><span>                    <span style=color:#a6e22e>onClick</span><span style=color:#f92672>=</span>{() <span style=color:#f92672>=&gt;</span>
</span></span><span style=display:flex><span>                      <span style=color:#a6e22e>setOptions</span>((<span style=color:#a6e22e>draft</span>) <span style=color:#f92672>=&gt;</span> {
</span></span><span style=display:flex><span>                        <span style=color:#a6e22e>draft</span>.<span style=color:#a6e22e>page</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>index</span>()
</span></span><span style=display:flex><span>                      })
</span></span><span style=display:flex><span>                    }
</span></span><span style=display:flex><span>                  &gt;
</span></span><span style=display:flex><span>                    {<span style=color:#a6e22e>page</span>}
</span></span><span style=display:flex><span>                  &lt;/<span style=color:#f92672>div</span>&gt;
</span></span><span style=display:flex><span>                &lt;/<span style=color:#f92672>li</span>&gt;
</span></span><span style=display:flex><span>              )}
</span></span><span style=display:flex><span>            &lt;/<span style=color:#f92672>For</span>&gt;
</span></span><span style=display:flex><span>            &lt;<span style=color:#f92672>li</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;page-item&#34;</span>&gt;
</span></span><span style=display:flex><span>              &lt;<span style=color:#f92672>div</span>
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;page-link&#34;</span>
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>onClick</span><span style=color:#f92672>=</span>{() <span style=color:#f92672>=&gt;</span> {
</span></span><span style=display:flex><span>                  <span style=color:#66d9ef>if</span> ((<span style=color:#a6e22e>options</span>().<span style=color:#a6e22e>page</span> <span style=color:#f92672>??</span> <span style=color:#ae81ff>0</span>) <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>posts</span>.<span style=color:#a6e22e>data</span>.<span style=color:#a6e22e>totalPages</span> <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>)
</span></span><span style=display:flex><span>                    <span style=color:#a6e22e>setOptions</span>((<span style=color:#a6e22e>draft</span>) <span style=color:#f92672>=&gt;</span> {
</span></span><span style=display:flex><span>                      <span style=color:#a6e22e>draft</span>.<span style=color:#a6e22e>page</span> <span style=color:#f92672>=</span> (<span style=color:#a6e22e>options</span>().<span style=color:#a6e22e>page</span> <span style=color:#f92672>??</span> <span style=color:#ae81ff>0</span>) <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>                    })
</span></span><span style=display:flex><span>                }}
</span></span><span style=display:flex><span>              &gt;
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>Next</span>
</span></span><span style=display:flex><span>              &lt;/<span style=color:#f92672>div</span>&gt;
</span></span><span style=display:flex><span>            &lt;/<span style=color:#f92672>li</span>&gt;
</span></span><span style=display:flex><span>          &lt;/<span style=color:#f92672>ul</span>&gt;
</span></span><span style=display:flex><span>        &lt;/<span style=color:#f92672>nav</span>&gt;
</span></span><span style=display:flex><span>      &lt;/<span style=color:#f92672>Match</span>&gt;
</span></span><span style=display:flex><span>    &lt;/<span style=color:#f92672>Switch</span>&gt;
</span></span><span style=display:flex><span>  )
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>default</span> <span style=color:#a6e22e>CategoryPosts</span>
</span></span></code></pre></div><p>之后在<code>router</code>目录中添加一个路由,布局是<code>HomeLayout</code>,路径是<code>/category/:categoryId</code>,组件是<code>CategoryPosts</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-tsx data-lang=tsx><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>path</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;/category/:categoryId&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>component</span><span style=color:#f92672>:</span> () <span style=color:#f92672>=&gt;</span> &lt;<span style=color:#f92672>CategoryPosts</span> /&gt;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=编写评论列表组件>编写评论列表组件</h3><p>在<code>components</code>目录下新建一个<code>Replys.tsx</code>文件,这个文件用于渲染评论列表</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-tsx data-lang=tsx><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>createQuery</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#34;@tanstack/solid-query&#34;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>createImmerSignal</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#34;solid-immer&#34;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>Component</span>, <span style=color:#a6e22e>For</span>, <span style=color:#a6e22e>Match</span>, <span style=color:#a6e22e>Switch</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#34;solid-js&#34;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>RequestOf</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#34;../__generated&#34;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>api</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#34;../common/ApiInstance&#34;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>ReplyInput</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#34;../__generated/model/static&#34;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> <span style=color:#a6e22e>toast</span> <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#34;solid-toast&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>Replys</span>: <span style=color:#66d9ef>Component</span><span style=color:#f92672>&lt;</span>{ <span style=color:#a6e22e>postId</span>: <span style=color:#66d9ef>string</span> }<span style=color:#f92672>&gt;</span> <span style=color:#f92672>=</span> ({ <span style=color:#a6e22e>postId</span> }) <span style=color:#f92672>=&gt;</span> {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> [<span style=color:#a6e22e>options</span>, <span style=color:#a6e22e>setOptions</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>createImmerSignal</span>&lt;<span style=color:#f92672>RequestOf</span><span style=color:#960050;background-color:#1e0010>&lt;</span><span style=color:#a6e22e>typeof</span> <span style=color:#a6e22e>api.replyController.findRepliesByPost</span>&gt;<span style=color:#f92672>&gt;</span>({ <span style=color:#a6e22e>postId</span> })
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>replies</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>createQuery</span>({
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>queryKey</span><span style=color:#f92672>:</span> () <span style=color:#f92672>=&gt;</span> [<span style=color:#e6db74>&#34;replies&#34;</span>, <span style=color:#a6e22e>options</span>()],
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>queryFn</span><span style=color:#f92672>:</span> () <span style=color:#f92672>=&gt;</span> <span style=color:#a6e22e>api</span>.<span style=color:#a6e22e>replyController</span>.<span style=color:#a6e22e>findRepliesByPost</span>(<span style=color:#a6e22e>options</span>())
</span></span><span style=display:flex><span>  })
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>formRef</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> [<span style=color:#a6e22e>form</span>, <span style=color:#a6e22e>setForm</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>createImmerSignal</span>&lt;<span style=color:#f92672>ReplyInput</span>&gt;({ <span style=color:#a6e22e>postId</span> })
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>submit</span> <span style=color:#f92672>=</span> (<span style=color:#a6e22e>e</span>) <span style=color:#f92672>=&gt;</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>e</span>.<span style=color:#a6e22e>preventDefault</span>()
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>e</span>.<span style=color:#a6e22e>stopPropagation</span>()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>formRef</span>.<span style=color:#a6e22e>checkValidity</span>()) {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>api</span>.<span style=color:#a6e22e>replyController</span>
</span></span><span style=display:flex><span>        .<span style=color:#a6e22e>createReply</span>({
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>body</span>: <span style=color:#66d9ef>form</span>()
</span></span><span style=display:flex><span>        })
</span></span><span style=display:flex><span>        .<span style=color:#a6e22e>then</span>(() <span style=color:#f92672>=&gt;</span> {
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>toast</span>.<span style=color:#a6e22e>success</span>(<span style=color:#e6db74>&#34;Reply created&#34;</span>)
</span></span><span style=display:flex><span>        })
</span></span><span style=display:flex><span>        .<span style=color:#66d9ef>catch</span>(() <span style=color:#f92672>=&gt;</span> {
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>toast</span>.<span style=color:#a6e22e>error</span>(<span style=color:#e6db74>&#34;Reply creation failed&#34;</span>)
</span></span><span style=display:flex><span>        })
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>formRef</span>.<span style=color:#a6e22e>classList</span>.<span style=color:#a6e22e>add</span>(<span style=color:#e6db74>&#34;was-validated&#34;</span>)
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> (
</span></span><span style=display:flex><span>    &lt;<span style=color:#f92672>div</span>&gt;
</span></span><span style=display:flex><span>      &lt;<span style=color:#f92672>div</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;card&#34;</span>&gt;
</span></span><span style=display:flex><span>        &lt;<span style=color:#f92672>form</span> <span style=color:#a6e22e>ref</span><span style=color:#f92672>=</span>{<span style=color:#a6e22e>formRef</span>} <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;needs-validation&#34;</span>&gt;
</span></span><span style=display:flex><span>          &lt;<span style=color:#f92672>div</span>&gt;
</span></span><span style=display:flex><span>            &lt;<span style=color:#f92672>label</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;form-label&#34;</span>&gt;<span style=color:#a6e22e>Content</span>&lt;/<span style=color:#f92672>label</span>&gt;
</span></span><span style=display:flex><span>            &lt;<span style=color:#f92672>textarea</span>
</span></span><span style=display:flex><span>              <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;form-control&#34;</span>
</span></span><span style=display:flex><span>              <span style=color:#a6e22e>value</span><span style=color:#f92672>=</span>{<span style=color:#a6e22e>form</span>().<span style=color:#a6e22e>content</span> <span style=color:#f92672>??</span> <span style=color:#e6db74>&#34;&#34;</span>}
</span></span><span style=display:flex><span>              <span style=color:#a6e22e>required</span>
</span></span><span style=display:flex><span>              <span style=color:#a6e22e>onInput</span><span style=color:#f92672>=</span>{(<span style=color:#a6e22e>e</span>) <span style=color:#f92672>=&gt;</span> <span style=color:#a6e22e>setForm</span>((<span style=color:#a6e22e>draft</span>) <span style=color:#f92672>=&gt;</span> (<span style=color:#a6e22e>draft</span>.<span style=color:#a6e22e>content</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>e</span>.<span style=color:#a6e22e>currentTarget</span>.<span style=color:#a6e22e>value</span>))}
</span></span><span style=display:flex><span>            /&gt;
</span></span><span style=display:flex><span>            &lt;<span style=color:#f92672>div</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;valid-feedback&#34;</span>&gt;<span style=color:#a6e22e>Looks</span> <span style=color:#a6e22e>good</span><span style=color:#f92672>!</span>&lt;/<span style=color:#f92672>div</span>&gt;
</span></span><span style=display:flex><span>            &lt;<span style=color:#f92672>div</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;invalid-feedback&#34;</span>&gt;<span style=color:#a6e22e>Please</span> <span style=color:#a6e22e>enter</span> <span style=color:#a6e22e>your</span> <span style=color:#a6e22e>reply</span>.&lt;/<span style=color:#f92672>div</span>&gt;
</span></span><span style=display:flex><span>          &lt;/<span style=color:#f92672>div</span>&gt;
</span></span><span style=display:flex><span>          &lt;<span style=color:#f92672>button</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;btn btn-primary&#34;</span> <span style=color:#a6e22e>type</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;submit&#34;</span> <span style=color:#a6e22e>onClick</span><span style=color:#f92672>=</span>{<span style=color:#a6e22e>submit</span>}&gt;
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>Reply</span>
</span></span><span style=display:flex><span>          &lt;/<span style=color:#f92672>button</span>&gt;
</span></span><span style=display:flex><span>        &lt;/<span style=color:#f92672>form</span>&gt;
</span></span><span style=display:flex><span>      &lt;/<span style=color:#f92672>div</span>&gt;
</span></span><span style=display:flex><span>      &lt;<span style=color:#f92672>Switch</span>&gt;
</span></span><span style=display:flex><span>        &lt;<span style=color:#f92672>Match</span> <span style=color:#a6e22e>when</span><span style=color:#f92672>=</span>{<span style=color:#a6e22e>replies</span>.<span style=color:#a6e22e>isLoading</span>}&gt;
</span></span><span style=display:flex><span>          &lt;<span style=color:#f92672>div</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;spinner-border&#34;</span> <span style=color:#a6e22e>role</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;status&#34;</span>&gt;
</span></span><span style=display:flex><span>            &lt;<span style=color:#f92672>span</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;visually-hidden&#34;</span>&gt;<span style=color:#a6e22e>Loading</span>...&lt;/<span style=color:#f92672>span</span>&gt;
</span></span><span style=display:flex><span>          &lt;/<span style=color:#f92672>div</span>&gt;
</span></span><span style=display:flex><span>        &lt;/<span style=color:#f92672>Match</span>&gt;
</span></span><span style=display:flex><span>        &lt;<span style=color:#f92672>Match</span> <span style=color:#a6e22e>when</span><span style=color:#f92672>=</span>{<span style=color:#a6e22e>replies</span>.<span style=color:#a6e22e>isError</span>}&gt;Error&lt;/<span style=color:#f92672>Match</span>&gt;
</span></span><span style=display:flex><span>        &lt;<span style=color:#f92672>Match</span> <span style=color:#a6e22e>when</span><span style=color:#f92672>=</span>{<span style=color:#a6e22e>replies</span>.<span style=color:#a6e22e>isSuccess</span>}&gt;
</span></span><span style=display:flex><span>          &lt;<span style=color:#f92672>ul</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;list-group&#34;</span>&gt;
</span></span><span style=display:flex><span>            &lt;<span style=color:#f92672>For</span> <span style=color:#a6e22e>each</span><span style=color:#f92672>=</span>{<span style=color:#a6e22e>replies</span>.<span style=color:#a6e22e>data</span>.<span style=color:#a6e22e>content</span>}&gt;
</span></span><span style=display:flex><span>              {(<span style=color:#a6e22e>reply</span>) <span style=color:#f92672>=&gt;</span> (
</span></span><span style=display:flex><span>                &lt;<span style=color:#f92672>li</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;list-group-item&#34;</span>&gt;
</span></span><span style=display:flex><span>                  &lt;<span style=color:#f92672>div</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;d-flex justify-content-between&#34;</span>&gt;
</span></span><span style=display:flex><span>                    &lt;<span style=color:#f92672>div</span>&gt;<span style=color:#a6e22e>User</span><span style=color:#f92672>:</span>{<span style=color:#a6e22e>reply</span>.<span style=color:#a6e22e>user</span>.<span style=color:#a6e22e>username</span>}&lt;/<span style=color:#f92672>div</span>&gt;
</span></span><span style=display:flex><span>                    &lt;<span style=color:#f92672>div</span>&gt;{<span style=color:#a6e22e>reply</span>.<span style=color:#a6e22e>content</span>}&lt;/<span style=color:#f92672>div</span>&gt;
</span></span><span style=display:flex><span>                  &lt;/<span style=color:#f92672>div</span>&gt;
</span></span><span style=display:flex><span>                &lt;/<span style=color:#f92672>li</span>&gt;
</span></span><span style=display:flex><span>              )}
</span></span><span style=display:flex><span>            &lt;/<span style=color:#f92672>For</span>&gt;
</span></span><span style=display:flex><span>          &lt;/<span style=color:#f92672>ul</span>&gt;
</span></span><span style=display:flex><span>          &lt;<span style=color:#f92672>nav</span> <span style=color:#a6e22e>aria-label</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;Page navigation example&#34;</span>&gt;
</span></span><span style=display:flex><span>            &lt;<span style=color:#f92672>ul</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;pagination&#34;</span>&gt;
</span></span><span style=display:flex><span>              &lt;<span style=color:#f92672>li</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;page-item&#34;</span>&gt;
</span></span><span style=display:flex><span>                &lt;<span style=color:#f92672>div</span>
</span></span><span style=display:flex><span>                  <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;page-link&#34;</span>
</span></span><span style=display:flex><span>                  <span style=color:#a6e22e>onClick</span><span style=color:#f92672>=</span>{() <span style=color:#f92672>=&gt;</span> {
</span></span><span style=display:flex><span>                    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>options</span>().<span style=color:#a6e22e>page</span> <span style=color:#f92672>??</span> <span style=color:#ae81ff>0</span> <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>0</span>)
</span></span><span style=display:flex><span>                      <span style=color:#a6e22e>setOptions</span>((<span style=color:#a6e22e>draft</span>) <span style=color:#f92672>=&gt;</span> {
</span></span><span style=display:flex><span>                        <span style=color:#a6e22e>draft</span>.<span style=color:#a6e22e>page</span> <span style=color:#f92672>=</span> (<span style=color:#a6e22e>options</span>().<span style=color:#a6e22e>page</span> <span style=color:#f92672>??</span> <span style=color:#ae81ff>0</span>) <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>                      })
</span></span><span style=display:flex><span>                  }}
</span></span><span style=display:flex><span>                &gt;
</span></span><span style=display:flex><span>                  <span style=color:#a6e22e>Previous</span>
</span></span><span style=display:flex><span>                &lt;/<span style=color:#f92672>div</span>&gt;
</span></span><span style=display:flex><span>              &lt;/<span style=color:#f92672>li</span>&gt;
</span></span><span style=display:flex><span>              &lt;<span style=color:#f92672>For</span> <span style=color:#a6e22e>each</span><span style=color:#f92672>=</span>{Array.<span style=color:#66d9ef>from</span>({ <span style=color:#a6e22e>length</span>: <span style=color:#66d9ef>replies.data.totalPages</span> }, (<span style=color:#a6e22e>_</span>, <span style=color:#a6e22e>i</span>) <span style=color:#f92672>=&gt;</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>)}&gt;
</span></span><span style=display:flex><span>                {(<span style=color:#a6e22e>page</span>, <span style=color:#a6e22e>index</span>) <span style=color:#f92672>=&gt;</span> (
</span></span><span style=display:flex><span>                  &lt;<span style=color:#f92672>li</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;page-item&#34;</span>&gt;
</span></span><span style=display:flex><span>                    &lt;<span style=color:#f92672>div</span>
</span></span><span style=display:flex><span>                      <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;page-link&#34;</span>
</span></span><span style=display:flex><span>                      <span style=color:#a6e22e>classList</span><span style=color:#f92672>=</span>{{ <span style=color:#a6e22e>active</span><span style=color:#f92672>:</span> (<span style=color:#a6e22e>options</span>().<span style=color:#a6e22e>page</span> <span style=color:#f92672>??</span> <span style=color:#ae81ff>0</span>) <span style=color:#f92672>===</span> <span style=color:#a6e22e>index</span>() }}
</span></span><span style=display:flex><span>                      <span style=color:#a6e22e>onClick</span><span style=color:#f92672>=</span>{() <span style=color:#f92672>=&gt;</span>
</span></span><span style=display:flex><span>                        <span style=color:#a6e22e>setOptions</span>((<span style=color:#a6e22e>draft</span>) <span style=color:#f92672>=&gt;</span> {
</span></span><span style=display:flex><span>                          <span style=color:#a6e22e>draft</span>.<span style=color:#a6e22e>page</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>index</span>()
</span></span><span style=display:flex><span>                        })
</span></span><span style=display:flex><span>                      }
</span></span><span style=display:flex><span>                    &gt;
</span></span><span style=display:flex><span>                      {<span style=color:#a6e22e>page</span>}
</span></span><span style=display:flex><span>                    &lt;/<span style=color:#f92672>div</span>&gt;
</span></span><span style=display:flex><span>                  &lt;/<span style=color:#f92672>li</span>&gt;
</span></span><span style=display:flex><span>                )}
</span></span><span style=display:flex><span>              &lt;/<span style=color:#f92672>For</span>&gt;
</span></span><span style=display:flex><span>              &lt;<span style=color:#f92672>li</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;page-item&#34;</span>&gt;
</span></span><span style=display:flex><span>                &lt;<span style=color:#f92672>div</span>
</span></span><span style=display:flex><span>                  <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;page-link&#34;</span>
</span></span><span style=display:flex><span>                  <span style=color:#a6e22e>onClick</span><span style=color:#f92672>=</span>{() <span style=color:#f92672>=&gt;</span> {
</span></span><span style=display:flex><span>                    <span style=color:#66d9ef>if</span> ((<span style=color:#a6e22e>options</span>().<span style=color:#a6e22e>page</span> <span style=color:#f92672>??</span> <span style=color:#ae81ff>0</span>) <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>replies</span>.<span style=color:#a6e22e>data</span>.<span style=color:#a6e22e>totalPages</span> <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>)
</span></span><span style=display:flex><span>                      <span style=color:#a6e22e>setOptions</span>((<span style=color:#a6e22e>draft</span>) <span style=color:#f92672>=&gt;</span> {
</span></span><span style=display:flex><span>                        <span style=color:#a6e22e>draft</span>.<span style=color:#a6e22e>page</span> <span style=color:#f92672>=</span> (<span style=color:#a6e22e>options</span>().<span style=color:#a6e22e>page</span> <span style=color:#f92672>??</span> <span style=color:#ae81ff>0</span>) <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>                      })
</span></span><span style=display:flex><span>                  }}
</span></span><span style=display:flex><span>                &gt;
</span></span><span style=display:flex><span>                  <span style=color:#a6e22e>Next</span>
</span></span><span style=display:flex><span>                &lt;/<span style=color:#f92672>div</span>&gt;
</span></span><span style=display:flex><span>              &lt;/<span style=color:#f92672>li</span>&gt;
</span></span><span style=display:flex><span>            &lt;/<span style=color:#f92672>ul</span>&gt;
</span></span><span style=display:flex><span>          &lt;/<span style=color:#f92672>nav</span>&gt;
</span></span><span style=display:flex><span>        &lt;/<span style=color:#f92672>Match</span>&gt;
</span></span><span style=display:flex><span>      &lt;/<span style=color:#f92672>Switch</span>&gt;
</span></span><span style=display:flex><span>    &lt;/<span style=color:#f92672>div</span>&gt;
</span></span><span style=display:flex><span>  )
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>default</span> <span style=color:#a6e22e>Replys</span>
</span></span></code></pre></div><p>最后将这个组件放到<code>Post.tsx</code>中</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-tsx data-lang=tsx><span style=display:flex><span>&lt;<span style=color:#f92672>Replys</span> <span style=color:#a6e22e>postId</span><span style=color:#f92672>=</span>{<span style=color:#a6e22e>params</span>.<span style=color:#a6e22e>id</span>} /&gt;
</span></span></code></pre></div><p>好了,到这里我们的博客就完成了,如果你想要看完整的代码,可以去<a href=https://github.com/Enaium-Learn/solid-blog>GitHub</a>上看</p></div><div class="d-flex justify-content-between"><a class=text-reset href=https://blog.enaium.cn/post/2023-2-3-%E8%A7%A3%E5%86%B3idea%E5%88%9B%E5%BB%BA%E6%88%96%E6%89%93%E5%BC%80%E9%A1%B9%E7%9B%AE%E6%97%B6%E4%B8%8B%E8%BD%BDgradle/>解决IDEA创建或打开项目时下载Gradle</a>
<a class=text-reset href=https://blog.enaium.cn/post/2023-5-27-java%E9%9D%A9%E5%91%BD%E6%80%A7orm%E6%A1%86%E6%9E%B6jimmer%E7%AE%80%E5%8D%95%E4%BB%8B%E7%BB%8D/>Java革命性ORM框架Jimmer简单介绍</a></div></div></div></div></div><footer class="p-5 bg-dark text-white text-center"><div class=container><p class=lead>Copyright &copy; 2024 Enaium</p></div></footer><script src=/js/bootstrap.bundle.min.js></script></body></html>